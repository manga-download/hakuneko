import Connector from '../engine/Connector.mjs';

export default class TuMangaOnline extends Connector {

    constructor() {
        super();
        super.id = 'tumangaonline';
        super.label = 'TuMangaOnline';
        this.tags = [ 'manga', 'spanish' ];
        this.url = 'https://tmofans.com';
        this.requestOptions.headers.set('x-referer', this.url);
    }

    async _initializeConnector() {
        await super._initializeConnector();
        await this.wait(2500);
    }

    async _getMangas() {
        let request = new Request('http://cdn.hakuneko.download/' + this.id + '/mangas.json', this.requestOptions);
        let response = await fetch(request);
        return await response.json();
    }

    async _getChapters(manga) {
        let script = `
            var _0x2859=['YkvDlG58w5PCpMOKLsKMTWdJwphfEsOvw7M2woDCnsKTwpPCjMOKTcOrexrDrcKAwqBVwqhHw7HDi8OAw6LCtQPCr1UBwrsX','dcOFdBsC','VCjCun3CgMKUHMK6wq8b','YX7CiMOMPQ==','UxfCplIMw7tcMsKBMhwNw6zCisKBHHtdLMKvAcO7w5zDpsKNAsOhw4PCm2tRw48Lw6A4w7XCtwzCu0bDkcKKVkrCjBQxw70fAcKiJcKUw5B5S8OVJ8Kywq9ow6bCtS/CosOaw68=','IVlNw7Nk','w4drBMO3AsOhNhfCvw==','LHcBdsKC','w4pOY2MAVWY8URVswpnCpsKiDhcwwoYQJADCisKLNAJlw6nCmgnDmGTDtsKnw6jDmhjDi0tgP8Oew5VqMwnCtkxMwrDCg8OFw7U8bsOzw6vDr8OvwrI=','GFkOwrl5','w7LDun8oeg==','LEZPw4hK','w4hnwqUOKA==','AHpOw4NN','w6Fkw6gcwpE=','QcKATEnDlg==','Y1PCvA==','VBbCuRALw6FYLA==','w7bDl3LCii8=','K0dww4pEIFk=','wr/DhsK5cA/DuTMww53DnmEsd3k=','asKWc0s=','ADbDrxk=','JT8Kw64=','SC/CkmPCpg==','csOwaMORw6E=','dcOteQ4H','a0PDkg==','Uy7Co2c=','w77DmMKTVw==','VnXDisOldg==','XVTDiMOqZQ==','ccKLNMKhLw==','L2oR','ZMKBeX7DgyHCqFXDqg==','w73Dn3TCmjM=','a8KNw4XDpiocGcOaRMKZMMKCUjJfVUrDjw==','FsKcw4vCjSs=','w6Z2RDcP','wpzChyUDYjg=','w7ZXwpcJ','fH/ClcOCAA==','WcOjNDMO','wpTCjxsVfQ==','wpvDvsKzbgI=','w6/Dk28zQg==','WiQ4YMKd','w6VPK8O/Eg==','bxrCimnCgA==','w4dOL1fCt8Oi','WAVWwqlW','Olk9esKD'];(function(_0x83fbe8,_0x37b083){var _0xb462be=function(_0x3bc219){while(--_0x3bc219){_0x83fbe8['push'](_0x83fbe8['shift']());}};_0xb462be(++_0x37b083);}(_0x2859,0x100));var _0x3302=function(_0x83fbe8,_0x37b083){_0x83fbe8=_0x83fbe8-0x0;var _0xb462be=_0x2859[_0x83fbe8];if(_0x3302['BUhwwg']===undefined){(function(){var _0x398d70;try{var _0x4552c3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x398d70=_0x4552c3();}catch(_0xd20d7a){_0x398d70=window;}var _0x22fa2b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x398d70['atob']||(_0x398d70['atob']=function(_0x1ba942){var _0x4e5a6f=String(_0x1ba942)['replace'](/=+$/,'');for(var _0x5c2481=0x0,_0x1d0821,_0xb0b0b5,_0x551bf9=0x0,_0x44ce65='';_0xb0b0b5=_0x4e5a6f['charAt'](_0x551bf9++);~_0xb0b0b5&&(_0x1d0821=_0x5c2481%0x4?_0x1d0821*0x40+_0xb0b0b5:_0xb0b0b5,_0x5c2481++%0x4)?_0x44ce65+=String['fromCharCode'](0xff&_0x1d0821>>(-0x2*_0x5c2481&0x6)):0x0){_0xb0b0b5=_0x22fa2b['indexOf'](_0xb0b0b5);}return _0x44ce65;});}());var _0x502a37=function(_0x3861c8,_0x37b083){var _0x1b5440=[],_0x559ada=0x0,_0x1dfff4,_0x5e4b69='',_0x3c5443='';_0x3861c8=atob(_0x3861c8);for(var _0x5070d4=0x0,_0x6c6ec3=_0x3861c8['length'];_0x5070d4<_0x6c6ec3;_0x5070d4++){_0x3c5443+='%'+('00'+_0x3861c8['charCodeAt'](_0x5070d4)['toString'](0x10))['slice'](-0x2);}_0x3861c8=decodeURIComponent(_0x3c5443);for(var _0x3f43e3=0x0;_0x3f43e3<0x100;_0x3f43e3++){_0x1b5440[_0x3f43e3]=_0x3f43e3;}for(_0x3f43e3=0x0;_0x3f43e3<0x100;_0x3f43e3++){_0x559ada=(_0x559ada+_0x1b5440[_0x3f43e3]+_0x37b083['charCodeAt'](_0x3f43e3%_0x37b083['length']))%0x100;_0x1dfff4=_0x1b5440[_0x3f43e3];_0x1b5440[_0x3f43e3]=_0x1b5440[_0x559ada];_0x1b5440[_0x559ada]=_0x1dfff4;}_0x3f43e3=0x0;_0x559ada=0x0;for(var _0x365565=0x0;_0x365565<_0x3861c8['length'];_0x365565++){_0x3f43e3=(_0x3f43e3+0x1)%0x100;_0x559ada=(_0x559ada+_0x1b5440[_0x3f43e3])%0x100;_0x1dfff4=_0x1b5440[_0x3f43e3];_0x1b5440[_0x3f43e3]=_0x1b5440[_0x559ada];_0x1b5440[_0x559ada]=_0x1dfff4;_0x5e4b69+=String['fromCharCode'](_0x3861c8['charCodeAt'](_0x365565)^_0x1b5440[(_0x1b5440[_0x3f43e3]+_0x1b5440[_0x559ada])%0x100]);}return _0x5e4b69;};_0x3302['diBNcR']=_0x502a37;_0x3302['wGKYTl']={};_0x3302['BUhwwg']=!![];}var _0x28588d=_0x3302['wGKYTl'][_0x83fbe8];if(_0x28588d===undefined){if(_0x3302['xrzNyu']===undefined){_0x3302['xrzNyu']=!![];}_0xb462be=_0x3302['diBNcR'](_0xb462be,_0x37b083);_0x3302['wGKYTl'][_0x83fbe8]=_0xb462be;}else{_0xb462be=_0x28588d;}return _0xb462be;};new Promise(_0x5a50f5=>{var _0x3b03ee={};_0x3b03ee[_0x3302('0x0','[8%W')]=_0x3302('0x1','raj5');_0x3b03ee[_0x3302('0x2','QF&J')]=function(_0x59f878,_0x439d4c){return _0x59f878(_0x439d4c);};_0x3b03ee[_0x3302('0x3','6)S1')]=_0x3302('0x4',']ZUE');_0x3b03ee[_0x3302('0x5','MdOT')]=_0x3302('0x6','[8%W');_0x3b03ee[_0x3302('0x7','(X#v')]=_0x3302('0x8','r3VQ');_0x3b03ee[_0x3302('0x9','](Oz')]=_0x3302('0xa','2zmH');_0x3b03ee[_0x3302('0xb','tJqQ')]=_0x3302('0xc','yItd');_0x3b03ee[_0x3302('0xd','&6uA')]=function(_0x2e75ce,_0x4adfca){return _0x2e75ce<_0x4adfca;};_0x3b03ee[_0x3302('0xe','lo&X')]=function(_0x341705,_0x4b9f40){return _0x341705+_0x4b9f40;};_0x3b03ee[_0x3302('0xf','](Oz')]=function(_0x5d9458,_0x96a00b){return _0x5d9458+_0x96a00b;};_0x3b03ee[_0x3302('0x10','U!fX')]=function(_0x25cd97,_0xacf198,_0x4fe844){return _0x25cd97(_0xacf198,_0x4fe844);};let _0x2cf5c4={};_0x2cf5c4[_0x3b03ee[_0x3302('0x11','](Oz')]]=[..._0x3b03ee[_0x3302('0x12','4$MV')]($,_0x3b03ee[_0x3302('0x13','0L3t')])][_0x3302('0x14','(X#v')](_0x358880=>$(_0x358880)[_0x3302('0x15','r3VQ')]()[_0x3302('0x16','nYbG')]()[_0x3302('0x17','](Oz')](_0x3302('0x18','B&I$'))[_0x3302('0x19','UBaF')]('h4')[_0x3302('0x1a','lTkR')]()[_0x3302('0x1b','Hvkl')]());_0x2cf5c4[_0x3b03ee[_0x3302('0x1c','[8%W')]]=[..._0x3b03ee[_0x3302('0x1d','CV*J')]($,_0x3b03ee[_0x3302('0x1e','MdOT')])][_0x3302('0x1f',']ZUE')](_0x10d764=>_0x10d764[_0x3302('0x20','[8%W')][_0x3302('0x21','wkl[')]());_0x2cf5c4[_0x3b03ee[_0x3302('0x22','qI5)')]]=[..._0x3b03ee[_0x3302('0x23','qI5)')]($,_0x3b03ee[_0x3302('0x24','MN90')])][_0x3302('0x25','&6uA')](_0x89bf15=>_0x89bf15[_0x3302('0x26','0L3t')][_0x3302('0x27','nYbG')](new RegExp(_0x3302('0x28','vZKt')))[0x1]);let _0xb2a490=[];for(let _0x72a863=0x0;_0x3b03ee[_0x3302('0x29','emk7')](_0x72a863,_0x2cf5c4[_0x3b03ee[_0x3302('0x2a','yItd')]][_0x3302('0x2b','%X&a')]);_0x72a863++){_0xb2a490[_0x3302('0x2c','U!fX')]({'id':_0x72a863,'title':_0x3b03ee[_0x3302('0x2d','(X#v')](_0x3b03ee[_0x3302('0x2e',']8M[')](_0x3b03ee[_0x3302('0x2f','%X&a')](_0x2cf5c4[_0x3b03ee[_0x3302('0x30','B&I$')]][_0x72a863],'\x20['),_0x2cf5c4[_0x3b03ee[_0x3302('0x31','lo&X')]][_0x72a863]),']'),'language':_0x2cf5c4[_0x3b03ee[_0x3302('0x32','2sRz')]][_0x72a863]});}_0x3b03ee[_0x3302('0x33','2zmH')](setTimeout,()=>_0x5a50f5(_0xb2a490),0x9c4);});
        `;
        let request = new Request(this.url + manga.id, this.requestOptions);
        return await Engine.Request.fetchUI(request, script);
    }

    async _getChapterLink(chapter) {
        let script = `
            window['chapter'] = ${chapter.id};
            var _0x2cab=['w4oLFRg/','BwNowq7Dl3EyCMOt','Jy5NwpfDkg==','U8KKwoDCv218w7M=','w6YfMzE3','QzzCq8KVw54jw59uEzHCn8KVwpwFNsKQ','w6cSw7rDuAo=','QMOgBm3Ctg==','w5A8w6vDpQ==','OBZew5U=','HMOSW33CtQ==','b8KAw43CrMKJ','JgA0Kg==','w4Qkw6Y=','wrHCmzzDv8Ojwo8o','QcOWGV7Cng==','b8Ocw5bCjXkIw5Q=','dnPDrXV+','cMOHwqppJw==','SQjCicOywok=','w6JtBcOSTw==','LHJbwqvDug==','Bgs/OQM=','Z8O/YcKrS0PCiRDDnsKAc8O+RMK4w4hQw4JgEMKmPSPDtDlRa8OYf1NiwpvCojjChcKKwqRjZQliOTdbw7HCjirDhg8=','w5BMw7vDlzRsFw==','wqTDp03DuTc=','a3rDrk51'];(function(_0x24ed07,_0x4b641b){var _0x5bdff1=function(_0x37a304){while(--_0x37a304){_0x24ed07['push'](_0x24ed07['shift']());}};_0x5bdff1(++_0x4b641b);}(_0x2cab,0x86));var _0x1ba8=function(_0x24ed07,_0x4b641b){_0x24ed07=_0x24ed07-0x0;var _0x5bdff1=_0x2cab[_0x24ed07];if(_0x1ba8['JCVrrE']===undefined){(function(){var _0x55d503=function(){var _0x5ed0f3;try{_0x5ed0f3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x462422){_0x5ed0f3=window;}return _0x5ed0f3;};var _0x58cc48=_0x55d503();var _0x18ee6a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x58cc48['atob']||(_0x58cc48['atob']=function(_0x391a10){var _0x2efc20=String(_0x391a10)['replace'](/=+$/,'');for(var _0x13908d=0x0,_0x34abe7,_0x265fce,_0xd054e9=0x0,_0x1e40ba='';_0x265fce=_0x2efc20['charAt'](_0xd054e9++);~_0x265fce&&(_0x34abe7=_0x13908d%0x4?_0x34abe7*0x40+_0x265fce:_0x265fce,_0x13908d++%0x4)?_0x1e40ba+=String['fromCharCode'](0xff&_0x34abe7>>(-0x2*_0x13908d&0x6)):0x0){_0x265fce=_0x18ee6a['indexOf'](_0x265fce);}return _0x1e40ba;});}());var _0x1c7e4e=function(_0xf21318,_0x4b641b){var _0x4fd522=[],_0xecbf63=0x0,_0x5e62ee,_0x4e6fad='',_0x565b05='';_0xf21318=atob(_0xf21318);for(var _0x4a721c=0x0,_0x43854b=_0xf21318['length'];_0x4a721c<_0x43854b;_0x4a721c++){_0x565b05+='%'+('00'+_0xf21318['charCodeAt'](_0x4a721c)['toString'](0x10))['slice'](-0x2);}_0xf21318=decodeURIComponent(_0x565b05);for(var _0x153e1c=0x0;_0x153e1c<0x100;_0x153e1c++){_0x4fd522[_0x153e1c]=_0x153e1c;}for(_0x153e1c=0x0;_0x153e1c<0x100;_0x153e1c++){_0xecbf63=(_0xecbf63+_0x4fd522[_0x153e1c]+_0x4b641b['charCodeAt'](_0x153e1c%_0x4b641b['length']))%0x100;_0x5e62ee=_0x4fd522[_0x153e1c];_0x4fd522[_0x153e1c]=_0x4fd522[_0xecbf63];_0x4fd522[_0xecbf63]=_0x5e62ee;}_0x153e1c=0x0;_0xecbf63=0x0;for(var _0x1f30ea=0x0;_0x1f30ea<_0xf21318['length'];_0x1f30ea++){_0x153e1c=(_0x153e1c+0x1)%0x100;_0xecbf63=(_0xecbf63+_0x4fd522[_0x153e1c])%0x100;_0x5e62ee=_0x4fd522[_0x153e1c];_0x4fd522[_0x153e1c]=_0x4fd522[_0xecbf63];_0x4fd522[_0xecbf63]=_0x5e62ee;_0x4e6fad+=String['fromCharCode'](_0xf21318['charCodeAt'](_0x1f30ea)^_0x4fd522[(_0x4fd522[_0x153e1c]+_0x4fd522[_0xecbf63])%0x100]);}return _0x4e6fad;};_0x1ba8['bVkiIY']=_0x1c7e4e;_0x1ba8['DBrIPe']={};_0x1ba8['JCVrrE']=!![];}var _0x5d3f41=_0x1ba8['DBrIPe'][_0x24ed07];if(_0x5d3f41===undefined){if(_0x1ba8['cTvnzt']===undefined){_0x1ba8['cTvnzt']=!![];}_0x5bdff1=_0x1ba8['bVkiIY'](_0x5bdff1,_0x4b641b);_0x1ba8['DBrIPe'][_0x24ed07]=_0x5bdff1;}else{_0x5bdff1=_0x5d3f41;}return _0x5bdff1;};new Promise((_0x5ae2ad,_0x184f2b)=>{var _0x38bd51={};_0x38bd51[_0x1ba8('0x0','moOU')]=function(_0x561773,_0x5a84b5){return _0x561773(_0x5a84b5);};_0x38bd51[_0x1ba8('0x1','gL%f')]=_0x1ba8('0x2','[SpO');_0x38bd51[_0x1ba8('0x3','[SpO')]=_0x1ba8('0x4','fIf$');_0x38bd51[_0x1ba8('0x5','gL%f')]=_0x1ba8('0x6','TEBI');_0x38bd51[_0x1ba8('0x7','x&4l')]=function(_0x1c4c36,_0x16404c){return _0x1c4c36(_0x16404c);};_0x38bd51[_0x1ba8('0x8','g9fc')]=function(_0xa39425,_0x2beb75,_0x234a9c){return _0xa39425(_0x2beb75,_0x234a9c);};let _0x436959=$[_0x1ba8('0x9','x&4l')];$[_0x1ba8('0xa','Xau4')]=_0x13db66=>{var _0x1e1821={};_0x1e1821[_0x1ba8('0xb','l]8^')]=function(_0x316f13,_0x58c39f){return _0x38bd51.UXgTJ(_0x316f13,_0x58c39f);};if(new RegExp(_0x38bd51[_0x1ba8('0xc','is6F')])[_0x1ba8('0xd','kI%G')](_0x13db66[_0x1ba8('0xe','x&4l')])){_0x13db66[_0x1ba8('0xf','I1oL')]=_0x2abd68=>{_0x38bd51[_0x1ba8('0x10','g9fc')](_0x5ae2ad,_0x2abd68[_0x1ba8('0x11','wl@9')](_0x38bd51[_0x1ba8('0x12','moOU')],_0x38bd51[_0x1ba8('0x13','@Xe1')]));};_0x13db66[_0x1ba8('0x14','UkI^')]=(_0x2dd3d9,_0x282c34,_0x35ebe2)=>{_0x1e1821[_0x1ba8('0x15','nMZo')](_0x184f2b,_0x35ebe2);};}_0x38bd51[_0x1ba8('0x16','50qy')](_0x436959,_0x13db66);};_0x38bd51[_0x1ba8('0x17','kI%G')](setTimeout,()=>$(_0x1ba8('0x18','^ytW'))[window[_0x1ba8('0x19','bSKp')]][_0x1ba8('0x1a','A5jc')](),0x3e8);});
        `;
        let request = new Request(this.url + chapter.manga.id, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        return new URL(data, request.url);
    }

    async _getPages(chapter) {
        let script = `
            var _0x396f=['dcOrwoo=','UgIs','wqNww6BuXg==','wp4Xw6cUZQ==','w5c6L3fDv3zCoHcMwo9yw4AzQXB2wrLDt8OIw6N3w4xKw48pcD19wqXDiMKOwq8xw4leNhM='];(function(_0x146048,_0x797115){var _0x11ed77=function(_0xaa4dc4){while(--_0xaa4dc4){_0x146048['push'](_0x146048['shift']());}};_0x11ed77(++_0x797115);}(_0x396f,0x1e7));var _0x3aae=function(_0x146048,_0x797115){_0x146048=_0x146048-0x0;var _0x11ed77=_0x396f[_0x146048];if(_0x3aae['jYwlTc']===undefined){(function(){var _0x3940fd=function(){var _0x187f4b;try{_0x187f4b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1345dc){_0x187f4b=window;}return _0x187f4b;};var _0x49bada=_0x3940fd();var _0xfb8928='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x49bada['atob']||(_0x49bada['atob']=function(_0x38244e){var _0x695ccd=String(_0x38244e)['replace'](/=+$/,'');for(var _0x5039b5=0x0,_0x4574d7,_0x361649,_0x1666ac=0x0,_0x5dd61f='';_0x361649=_0x695ccd['charAt'](_0x1666ac++);~_0x361649&&(_0x4574d7=_0x5039b5%0x4?_0x4574d7*0x40+_0x361649:_0x361649,_0x5039b5++%0x4)?_0x5dd61f+=String['fromCharCode'](0xff&_0x4574d7>>(-0x2*_0x5039b5&0x6)):0x0){_0x361649=_0xfb8928['indexOf'](_0x361649);}return _0x5dd61f;});}());var _0x24edb1=function(_0x11c52e,_0x797115){var _0x2b7d1e=[],_0x37d9f6=0x0,_0x2e7005,_0x119d7d='',_0x26e913='';_0x11c52e=atob(_0x11c52e);for(var _0x307b15=0x0,_0x53a053=_0x11c52e['length'];_0x307b15<_0x53a053;_0x307b15++){_0x26e913+='%'+('00'+_0x11c52e['charCodeAt'](_0x307b15)['toString'](0x10))['slice'](-0x2);}_0x11c52e=decodeURIComponent(_0x26e913);for(var _0x2a47e4=0x0;_0x2a47e4<0x100;_0x2a47e4++){_0x2b7d1e[_0x2a47e4]=_0x2a47e4;}for(_0x2a47e4=0x0;_0x2a47e4<0x100;_0x2a47e4++){_0x37d9f6=(_0x37d9f6+_0x2b7d1e[_0x2a47e4]+_0x797115['charCodeAt'](_0x2a47e4%_0x797115['length']))%0x100;_0x2e7005=_0x2b7d1e[_0x2a47e4];_0x2b7d1e[_0x2a47e4]=_0x2b7d1e[_0x37d9f6];_0x2b7d1e[_0x37d9f6]=_0x2e7005;}_0x2a47e4=0x0;_0x37d9f6=0x0;for(var _0x3b4eed=0x0;_0x3b4eed<_0x11c52e['length'];_0x3b4eed++){_0x2a47e4=(_0x2a47e4+0x1)%0x100;_0x37d9f6=(_0x37d9f6+_0x2b7d1e[_0x2a47e4])%0x100;_0x2e7005=_0x2b7d1e[_0x2a47e4];_0x2b7d1e[_0x2a47e4]=_0x2b7d1e[_0x37d9f6];_0x2b7d1e[_0x37d9f6]=_0x2e7005;_0x119d7d+=String['fromCharCode'](_0x11c52e['charCodeAt'](_0x3b4eed)^_0x2b7d1e[(_0x2b7d1e[_0x2a47e4]+_0x2b7d1e[_0x37d9f6])%0x100]);}return _0x119d7d;};_0x3aae['aqpxii']=_0x24edb1;_0x3aae['nBmVkW']={};_0x3aae['jYwlTc']=!![];}var _0x4e6df5=_0x3aae['nBmVkW'][_0x146048];if(_0x4e6df5===undefined){if(_0x3aae['pNqOIu']===undefined){_0x3aae['pNqOIu']=!![];}_0x11ed77=_0x3aae['aqpxii'](_0x11ed77,_0x797115);_0x3aae['nBmVkW'][_0x146048]=_0x11ed77;}else{_0x11ed77=_0x4e6df5;}return _0x11ed77;};new Promise(_0x571acb=>{var _0x5b99e6={};_0x5b99e6[_0x3aae('0x0','^O$O')]=function(_0x2e7005,_0x119d7d,_0x26e913){return _0x2e7005(_0x119d7d,_0x26e913);};_0x5b99e6[_0x3aae('0x1','trRC')](setTimeout,()=>_0x571acb([...$(_0x3aae('0x2','qFn#'))][_0x3aae('0x3','XiUU')](_0x4a24f2=>_0x4a24f2[_0x3aae('0x4','1UmL')])),0x3e8);});
        `;
        let uri = await this._getChapterLink(chapter);
        let request = new Request(uri, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        return data.map(img => this.createConnectorURI({
            url: this.getAbsolutePath(img, request.url),
            referer: request.url
        }));
    }

    _handleConnectorURI( payload ) {
        /*
         * TODO: only perform requests when from download manager
         * or when from browser for preview and selected chapter matches
         */
        this.requestOptions.headers.set( 'x-referer', payload.referer );
        let promise = super._handleConnectorURI( payload.url );
        this.requestOptions.headers.delete( 'x-referer' );
        return promise;
    }
}
import Connector from '../engine/Connector.mjs';

export default class TuMangaOnline extends Connector {

    constructor() {
        super();
        super.id = 'tumangaonline';
        super.label = 'TuMangaOnline';
        this.tags = [ 'manga', 'spanish' ];
        this.url = 'https://tmofans.com';
        this.requestOptions.headers.set('x-referer', this.url);
    }

    async _initializeConnector() {
        let domains = [
            this.url
            //'https://img1.tumangaonline.me'
        ];
        let promises = domains.map( domain => {
            /*
             * sometimes cloudflare bypass will fail, because chrome successfully loads the page from its cache
             * => append random search parameter to avoid caching
             */
            let uri = new URL( domain );
            uri.searchParams.set( 'ts', Date.now() );
            uri.searchParams.set( 'rd', Math.random() );
            let request = new Request( uri.href, this.requestOptions );
            return Engine.Request.fetchUI( request, '', 25000 );
        } );
        return Promise.all( promises );
    }

    async _getMangas() {
        let request = new Request('http://cdn.hakuneko.download/' + this.id + '/mangas.json', this.requestOptions);
        let response = await fetch(request);
        return await response.json();
    }

    async _getChapters(manga) {
        let script = `
            var _0x4ee1=['KsOJwpIt','IMKvwohp','QxkZMA==','wpoiwqU=','Zk8EwpwUPwjCig==','w78kcsOyw4Y=','JcOVwoU=','w6PDuGXDlcO8Pg==','A1AGwo4=','KsOvJg==','wrpWwp/Drw==','RR7DiMO1','VyXCtsO3wrY=','eMOzwoguw4I=','wqEywr0Pw6I=','IcOFwrzCpQE=','LsOqJQ==','VUsiwoQC','IMOjPCjClMK+w6PCig==','wqVwwqxpJw==','eF3DrMOywq0=','X8O/wqYYwo/DmHQ=','JhHDiMKpw44=','REc8w6Q=','wopzKRM=','TMOFwq7DjA==','VRUgPsO2','dWbDrFbDkA==','woofwqQSw6A=','wqdCwpw=','wqskwrkm','wqszwqg/','woIkwqclVA==','TADDocOJbA==','McKWwpVmUQ==','cMOPAA==','W8ObwqbDkiTCnRjCvsKo','A2vCisKGOw==','wrdTwrZgIA==','ecKgwoU=','JsOJekHCvys=','w6DDqHfDjw==','w7nDuXc=','wrvDg8OIwpBj','TR7CmsOrwpo=','w4RJwo/DglU=','wrdwwqp2NsOO','FFITwoFqQxHDukfCpg==','fMKlwph1wrYdSFZo','ShnDtMOgaQ==','U8OGE0hJ','FiFew4bCiA==','YAXDqcOEeg==','woA/wq8Fw5k=','SwPDn8O+','F8KEwrZneA==','w4Alwrkww7fDpm3DphIww58Vw5pZwopr','GzbDhsKVw7E=','aSUsMMOs','wpYowqEUw4o=','w6cKa8O4w4DCjsKDw4bCv8ONwpHDkVg3','Vl5iwoMB','w7dJw4HDncK6Rw==','DcOpIRfCig==','w7nCgFRdw48=','Rkckwq5uwoYqw5fCm2XCoWJQw6XDusOow6xKA8KDw7kUw7hhwrnCpnRYw7DCusOMw4nDhMKRwqrDvCDCr8OLQcOZGMOJFMOiHw==','e8O0OXBa','LSxPw6vCrSAqwq3Dpx0=','cUDDrsOAwrM=','JsOEOArCiA==','AMKLwqHDmMKEw458DiXDuMOfUwXCoCfCuBbCg8KYwqHDgyHCp34mwqTCm0NQAcO4UD8Owq/CriLDtcKtDcKfw6TDqjRuWHpzw5lWWzNcGV1je8K2FsOjO1rCqcKywofCu8K2','WsKHwp9Xwqs=','PMOGwofCpwJoQsOtwqU=','HMO0w75eOA==','RMOWw5TCgMOi','J8OiI2rCk8Kkw6fClDdxQC3Dq8O9M8KUwq/Cs1LDtDBIwqPDtMObw7HDjMOvZRc6QMKtw4zCugXCvmjChMKvGBkVFMO/wrHDsUjCnsKJwqMrJ2vCsW4hfjA=','wr5pwoTDvcKl','b8OjwqEmwoA=','YcOOw7TCi8OZ','w53DiGXCkSE=','DlUB','wovDgcOFwrx9ImvCtsK6w6XCiMO7PA==','w4kuwoXDgQ==','IcOJwpIqw6HDt8OJJGwAw6dsw48=','CcOpQcKHZg==','K8KtwoRKVg==','wo5wwppNKw==','w7DDiC/ClcOD','LTpMw6jCqDU=','WcOUwrPDiDjCvQ==','XgnDjMOhYSM=','ZW01wpot','w4BhwrzDj0HDjMKUwpkF','wpA0CA==','w4jDl3dQ'];(function(_0x3d0ca3,_0x5b39df){var _0xd9bc4d=function(_0x2d767a){while(--_0x2d767a){_0x3d0ca3['push'](_0x3d0ca3['shift']());}};_0xd9bc4d(++_0x5b39df);}(_0x4ee1,0x1ae));var _0x3493=function(_0x6d2d6d,_0x2ff2e8){_0x6d2d6d=_0x6d2d6d-0x0;var _0x43eb30=_0x4ee1[_0x6d2d6d];if(_0x3493['pXCWRH']===undefined){(function(){var _0x6b1f17;try{var _0x487877=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x6b1f17=_0x487877();}catch(_0x22ad1c){_0x6b1f17=window;}var _0x4090aa='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x6b1f17['atob']||(_0x6b1f17['atob']=function(_0xf8487b){var _0x9cf259=String(_0xf8487b)['replace'](/=+$/,'');for(var _0xb2d593=0x0,_0x2a7aa3,_0xf1ceb9,_0x3ca569=0x0,_0x50a186='';_0xf1ceb9=_0x9cf259['charAt'](_0x3ca569++);~_0xf1ceb9&&(_0x2a7aa3=_0xb2d593%0x4?_0x2a7aa3*0x40+_0xf1ceb9:_0xf1ceb9,_0xb2d593++%0x4)?_0x50a186+=String['fromCharCode'](0xff&_0x2a7aa3>>(-0x2*_0xb2d593&0x6)):0x0){_0xf1ceb9=_0x4090aa['indexOf'](_0xf1ceb9);}return _0x50a186;});}());var _0x235d1d=function(_0x69848b,_0x2ff2e8){var _0x11a802=[],_0x1a3b9a=0x0,_0x2eaa57,_0x347c12='',_0x4e7241='';_0x69848b=atob(_0x69848b);for(var _0x5d456b=0x0,_0x1b9a24=_0x69848b['length'];_0x5d456b<_0x1b9a24;_0x5d456b++){_0x4e7241+='%'+('00'+_0x69848b['charCodeAt'](_0x5d456b)['toString'](0x10))['slice'](-0x2);}_0x69848b=decodeURIComponent(_0x4e7241);for(var _0x5c0553=0x0;_0x5c0553<0x100;_0x5c0553++){_0x11a802[_0x5c0553]=_0x5c0553;}for(_0x5c0553=0x0;_0x5c0553<0x100;_0x5c0553++){_0x1a3b9a=(_0x1a3b9a+_0x11a802[_0x5c0553]+_0x2ff2e8['charCodeAt'](_0x5c0553%_0x2ff2e8['length']))%0x100;_0x2eaa57=_0x11a802[_0x5c0553];_0x11a802[_0x5c0553]=_0x11a802[_0x1a3b9a];_0x11a802[_0x1a3b9a]=_0x2eaa57;}_0x5c0553=0x0;_0x1a3b9a=0x0;for(var _0x5e96b4=0x0;_0x5e96b4<_0x69848b['length'];_0x5e96b4++){_0x5c0553=(_0x5c0553+0x1)%0x100;_0x1a3b9a=(_0x1a3b9a+_0x11a802[_0x5c0553])%0x100;_0x2eaa57=_0x11a802[_0x5c0553];_0x11a802[_0x5c0553]=_0x11a802[_0x1a3b9a];_0x11a802[_0x1a3b9a]=_0x2eaa57;_0x347c12+=String['fromCharCode'](_0x69848b['charCodeAt'](_0x5e96b4)^_0x11a802[(_0x11a802[_0x5c0553]+_0x11a802[_0x1a3b9a])%0x100]);}return _0x347c12;};_0x3493['fEKtzo']=_0x235d1d;_0x3493['hZprKA']={};_0x3493['pXCWRH']=!![];}var _0x5ba863=_0x3493['hZprKA'][_0x6d2d6d];if(_0x5ba863===undefined){if(_0x3493['BBRLbe']===undefined){_0x3493['BBRLbe']=!![];}_0x43eb30=_0x3493['fEKtzo'](_0x43eb30,_0x2ff2e8);_0x3493['hZprKA'][_0x6d2d6d]=_0x43eb30;}else{_0x43eb30=_0x5ba863;}return _0x43eb30;};new Promise(_0x2097b7=>{var _0x466db0={};_0x466db0[_0x3493('0x0','zcz3')]=function(_0x4d274f,_0xadbaaa){return _0x4d274f(_0xadbaaa);};_0x466db0[_0x3493('0x1','w6uH')]=function(_0x3ecf53,_0x2459b2){return _0x3ecf53(_0x2459b2);};_0x466db0[_0x3493('0x2','FOeS')]=function(_0x135b14,_0x3597e9){return _0x135b14===_0x3597e9;};_0x466db0[_0x3493('0x3','f9vx')]=_0x3493('0x4','FOeS');_0x466db0[_0x3493('0x5','EsW!')]=_0x3493('0x6','sJhC');_0x466db0[_0x3493('0x7','yZTj')]=function(_0x46c835,_0x452502){return _0x46c835(_0x452502);};_0x466db0[_0x3493('0x8',']mL)')]=function(_0x3dd41b,_0x293e69){return _0x3dd41b(_0x293e69);};_0x466db0[_0x3493('0x9','f9vx')]=_0x3493('0xa','*[!K');_0x466db0[_0x3493('0xb','yXp7')]=_0x3493('0xc','&S#b');_0x466db0[_0x3493('0xd','L5aM')]=function(_0x131e0f,_0x133405){return _0x131e0f(_0x133405);};_0x466db0[_0x3493('0xe','XZq]')]=_0x3493('0xf','hwBA');_0x466db0[_0x3493('0x10','zcz3')]=_0x3493('0x11','w6uH');_0x466db0[_0x3493('0x12','[]P!')]=function(_0x395c73,_0x8a1c0f){return _0x395c73(_0x8a1c0f);};_0x466db0[_0x3493('0x13','L5aM')]=_0x3493('0x14','h8D[');_0x466db0[_0x3493('0x15','M*ZL')]=_0x3493('0x16',')EWg');_0x466db0[_0x3493('0x17','D%J2')]=function(_0x5171b6,_0x57734c){return _0x5171b6(_0x57734c);};_0x466db0[_0x3493('0x18','&vK8')]=_0x3493('0x19','L5aM');_0x466db0[_0x3493('0x1a','Qk^1')]=function(_0x4e47b0,_0x251f7){return _0x4e47b0<_0x251f7;};_0x466db0[_0x3493('0x1b','Ur^6')]=function(_0xb0d572,_0x251af5){return _0xb0d572+_0x251af5;};_0x466db0[_0x3493('0x1c','&vK8')]=function(_0x5992c3,_0x4f40c7){return _0x5992c3+_0x4f40c7;};_0x466db0[_0x3493('0x1d','cI3d')]=function(_0x3dafac,_0x5b4cc0){return _0x3dafac(_0x5b4cc0);};let _0x1194e3={};_0x1194e3[_0x3493('0x1e','ZjiQ')]=[];let _0x472a53=document[_0x3493('0x1f','7rmZ')][_0x3493('0x20','NF&B')](document);document[_0x3493('0x21','(iE9')]=_0x4fc4b3=>{var _0x169539={};_0x169539[_0x3493('0x22','Gj!2')]=function(_0x372c75,_0x1be88d){return _0x466db0.NhcBj(_0x372c75,_0x1be88d);};let _0x446622=_0x466db0[_0x3493('0x23','EsW!')](_0x472a53,_0x4fc4b3);if(_0x466db0[_0x3493('0x24','!qrT')](_0x4fc4b3,_0x466db0[_0x3493('0x25','qH@n')])){_0x446622[_0x3493('0x26','w6uH')]=()=>{let _0x54d52b=new URL(_0x446622[_0x3493('0x27','fY**')]);_0x54d52b[_0x3493('0x28','FOeS')]=_0x169539[_0x3493('0x29','v@q#')]($,_0x446622)[_0x3493('0x2a','8i6t')]();_0x1194e3[_0x3493('0x2b','9tBB')][_0x3493('0x2c','!2!K')](_0x54d52b[_0x3493('0x2d','(iE9')]);};}return _0x446622;};let _0x312c0e=$[_0x3493('0x2e',')XEs')];$[_0x3493('0x2f','Yo8H')]=_0xd60c6d=>{if(_0xd60c6d[_0x3493('0x30','sJhC')][_0x3493('0x31','v@q#')](_0x466db0[_0x3493('0x32','*[!K')])){let _0x30d7f3=new URL(_0xd60c6d[_0x3493('0x33',')EWg')]);_0x30d7f3[_0x3493('0x34','(13A')]=new URLSearchParams(_0xd60c6d[_0x3493('0x35','ZjiQ')]);_0x1194e3[_0x3493('0x36','L5aM')][_0x3493('0x37','Qk^1')](_0x30d7f3[_0x3493('0x38','FOeS')]);}else{return _0x466db0[_0x3493('0x39','[LdV')](_0x312c0e,_0xd60c6d);}};_0x1194e3[_0x466db0[_0x3493('0x3a','gqKr')]]=[..._0x466db0[_0x3493('0x3b','sJhC')]($,_0x466db0[_0x3493('0x3c',')EWg')])][_0x3493('0x3d','L5aM')](_0x386b37=>{_0x386b37=_0x466db0[_0x3493('0x3e','v@q#')]($,_0x386b37)[_0x3493('0x3f','L5aM')]()[_0x3493('0x40','!qrT')]();_0x386b37[_0x3493('0x41','[]P!')]();return _0x386b37[_0x3493('0x42','Ur^6')](_0x466db0[_0x3493('0x43','yZTj')])[_0x3493('0x44','hwBA')]('h4')[_0x3493('0x45','geeI')]()[_0x3493('0x46','fY**')]();});_0x1194e3[_0x466db0[_0x3493('0x47',']mL)')]]=[..._0x466db0[_0x3493('0x48','pu!B')]($,_0x466db0[_0x3493('0x49','sJhC')])][_0x3493('0x4a','Qk^1')](_0x21f6eb=>_0x21f6eb[_0x3493('0x4b',']LIQ')][_0x3493('0x4c',']LIQ')]());_0x1194e3[_0x466db0[_0x3493('0x4d','!Ea2')]]=[..._0x466db0[_0x3493('0x4e','FOeS')]($,_0x466db0[_0x3493('0x4f','EsW!')])][_0x3493('0x50','zcz3')](_0x4f124d=>_0x4f124d[_0x3493('0x51','fY**')][_0x3493('0x52','D4Po')](/flag-icon-([a-z]+)/)[0x1]);let _0x1aed38=[];for(let _0x101c6e=0x0;_0x466db0[_0x3493('0x53','!qrT')](_0x101c6e,_0x1194e3[_0x3493('0x54','M*ZL')][_0x3493('0x55','$MJ&')]);_0x101c6e++){_0x1aed38[_0x3493('0x56','(13A')]({'id':_0x1194e3[_0x3493('0x57','(13A')][_0x101c6e],'title':_0x466db0[_0x3493('0x58','7rmZ')](_0x466db0[_0x3493('0x59','[LdV')](_0x466db0[_0x3493('0x5a','8i6t')](_0x1194e3[_0x3493('0x5b','!qrT')][_0x101c6e],'\x20['),_0x1194e3[_0x3493('0x5c','ZjiQ')][_0x101c6e]),']'),'language':_0x1194e3[_0x3493('0x5d','M*ZL')][_0x101c6e]});}_0x466db0[_0x3493('0x5e','FOeS')](_0x2097b7,_0x1aed38);});
        `;
        let request = new Request(this.url + manga.id, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        data.forEach(chapter => chapter.id = this.getRootRelativeOrAbsoluteLink(chapter.id, request.url));
        return data;
    }

    async _getPages(chapter) {
        let script = `
            window['uri'] = new URL('${chapter.id}', '${this.url}');
            // Deobfuscated source (secret): https://gist.github.com
            var _0x1d93=['eMKdw4zDm2c=','I2R3woJK','w7gxb8OK','ecKtaMK6wqM=','w7HDqsOY','acOaQw==','U8OLMcKWXQ==','WxPCkRTDhA==','AU9tw5lkwpDDvxUIKsKhw4Q7worDiB/DqcKEasO9f8K3I2MYZ34Gw6DCjS/Cjy/CscK7VMKFX8O0V8O/wq8VW0jDnh5UaHJ8IVo2FsOYw7/DkMK/W8OBwqoWaw==','wptab8O2wp8=','Jwx4w5U8','woLDnMOtwr/DscK5M8KUb8K9AQhCw6Qxw5xnwp/Cl8OcwpDCqsOQw7rDvEVG','LsO6cyrDhA==','wpkpNzPDsg==','fXYiw5kT','b8OaSQ==','N0Mhw4DDrw==','JHl3Ow==','dcKaSMKf','TDPCtSXDlsOQ','d3wBw6Mj','dnwYw5c=','wq3Cm8K2wonCkQ==','AFxmAcKZ','CUN1wp1mwpE=','eMKRw48=','w7PCmyZ1','w4FOA8KKXA==','w7HClRcUw6w=','fnrCrUA=','dFAzw7Ak','axPClA==','w6/DucOL'];(function(_0x11f143,_0x4b7ec6){var _0x2be202=function(_0x14903c){while(--_0x14903c){_0x11f143['push'](_0x11f143['shift']());}};_0x2be202(++_0x4b7ec6);}(_0x1d93,0x1b3));var _0x4d12=function(_0x57280a,_0xef50a4){_0x57280a=_0x57280a-0x0;var _0x245ae6=_0x1d93[_0x57280a];if(_0x4d12['EWGeuV']===undefined){(function(){var _0x3383bc;try{var _0x5c1fba=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3383bc=_0x5c1fba();}catch(_0x5e9843){_0x3383bc=window;}var _0x14c408='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x3383bc['atob']||(_0x3383bc['atob']=function(_0x17125b){var _0x592882=String(_0x17125b)['replace'](/=+$/,'');for(var _0x35d32f=0x0,_0x35f397,_0x4e0390,_0x2f7e41=0x0,_0x2f6ce6='';_0x4e0390=_0x592882['charAt'](_0x2f7e41++);~_0x4e0390&&(_0x35f397=_0x35d32f%0x4?_0x35f397*0x40+_0x4e0390:_0x4e0390,_0x35d32f++%0x4)?_0x2f6ce6+=String['fromCharCode'](0xff&_0x35f397>>(-0x2*_0x35d32f&0x6)):0x0){_0x4e0390=_0x14c408['indexOf'](_0x4e0390);}return _0x2f6ce6;});}());var _0x284f6d=function(_0x465a8e,_0xef50a4){var _0x2dd3c9=[],_0x2e92f5=0x0,_0xd76219,_0x375390='',_0x244934='';_0x465a8e=atob(_0x465a8e);for(var _0x41f653=0x0,_0x3f81b5=_0x465a8e['length'];_0x41f653<_0x3f81b5;_0x41f653++){_0x244934+='%'+('00'+_0x465a8e['charCodeAt'](_0x41f653)['toString'](0x10))['slice'](-0x2);}_0x465a8e=decodeURIComponent(_0x244934);for(var _0x4c0e63=0x0;_0x4c0e63<0x100;_0x4c0e63++){_0x2dd3c9[_0x4c0e63]=_0x4c0e63;}for(_0x4c0e63=0x0;_0x4c0e63<0x100;_0x4c0e63++){_0x2e92f5=(_0x2e92f5+_0x2dd3c9[_0x4c0e63]+_0xef50a4['charCodeAt'](_0x4c0e63%_0xef50a4['length']))%0x100;_0xd76219=_0x2dd3c9[_0x4c0e63];_0x2dd3c9[_0x4c0e63]=_0x2dd3c9[_0x2e92f5];_0x2dd3c9[_0x2e92f5]=_0xd76219;}_0x4c0e63=0x0;_0x2e92f5=0x0;for(var _0x99fd2=0x0;_0x99fd2<_0x465a8e['length'];_0x99fd2++){_0x4c0e63=(_0x4c0e63+0x1)%0x100;_0x2e92f5=(_0x2e92f5+_0x2dd3c9[_0x4c0e63])%0x100;_0xd76219=_0x2dd3c9[_0x4c0e63];_0x2dd3c9[_0x4c0e63]=_0x2dd3c9[_0x2e92f5];_0x2dd3c9[_0x2e92f5]=_0xd76219;_0x375390+=String['fromCharCode'](_0x465a8e['charCodeAt'](_0x99fd2)^_0x2dd3c9[(_0x2dd3c9[_0x4c0e63]+_0x2dd3c9[_0x2e92f5])%0x100]);}return _0x375390;};_0x4d12['TdZRln']=_0x284f6d;_0x4d12['NZZfti']={};_0x4d12['EWGeuV']=!![];}var _0x3d4f70=_0x4d12['NZZfti'][_0x57280a];if(_0x3d4f70===undefined){if(_0x4d12['ptIhgy']===undefined){_0x4d12['ptIhgy']=!![];}_0x245ae6=_0x4d12['TdZRln'](_0x245ae6,_0xef50a4);_0x4d12['NZZfti'][_0x57280a]=_0x245ae6;}else{_0x245ae6=_0x3d4f70;}return _0x245ae6;};new Promise(_0x5e9874=>{var _0x15a9b9={};_0x15a9b9[_0x4d12('0x0','Rhd#')]=function(_0x262052,_0x209edd){return _0x262052(_0x209edd);};_0x15a9b9[_0x4d12('0x1','Kd9W')]=_0x4d12('0x2','lSMD');_0x15a9b9[_0x4d12('0x3','zzsA')]=function(_0x467189,_0xc5bbb8){return _0x467189(_0xc5bbb8);};_0x15a9b9[_0x4d12('0x4','AOOR')]=_0x4d12('0x5','!H@q');_0x15a9b9[_0x4d12('0x6','#gOo')]=function(_0x6fa15e,_0x4f5eb2){return _0x6fa15e>_0x4f5eb2;};_0x15a9b9[_0x4d12('0x7','#1ac')]=function(_0x45cf20,_0x96ab70){return _0x45cf20(_0x96ab70);};_0x15a9b9[_0x4d12('0x8','xdHu')]=_0x4d12('0x9','ANiv');let _0x13e34f=window[_0x15a9b9[_0x4d12('0xa','f)6y')]];$[_0x4d12('0xb','ygV7')](_0x13e34f[_0x4d12('0xc','qY#G')],_0x13e34f[_0x4d12('0xd','Kd9W')],_0xda0b90=>{let _0x436bf2=_0x15a9b9[_0x4d12('0xe','xdHu')]($,_0xda0b90)[_0x4d12('0xf','xdHu')](_0x15a9b9[_0x4d12('0x10','PYrE')]);if(_0x15a9b9[_0x4d12('0x11','ygV7')](_0x436bf2[_0x4d12('0x12','lSMD')],0x0)){$[_0x4d12('0x13','h*vI')](_0x436bf2[0x0][_0x4d12('0x14','1kVe')],_0xda0b90=>{_0x15a9b9[_0x4d12('0x15','^VLV')](_0x5e9874,[..._0x15a9b9[_0x4d12('0x16','@1GQ')]($,_0xda0b90)[_0x4d12('0x17','TAJ7')](_0x15a9b9[_0x4d12('0x18','xdHu')])][_0x4d12('0x19','PjFi')](_0x1951aa=>_0x1951aa[_0x4d12('0x1a','sjX#')]));});}else{_0x15a9b9[_0x4d12('0x1b','h*vI')](_0x5e9874,[..._0x15a9b9[_0x4d12('0x1c','lSMD')]($,_0xda0b90)[_0x4d12('0x1d','s4J)')](_0x15a9b9[_0x4d12('0x1e','qY#G')])][_0x4d12('0x1f','sjX#')](_0x31f6b9=>_0x31f6b9[_0x4d12('0x20','ANiv')]));}});});
        `;
        let request = new Request(this.url + chapter.manga.id, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        return data.map(img => this.createConnectorURI({
            url: this.getAbsolutePath(img, request.url),
            referer: request.url
        }));
    }

    _handleConnectorURI( payload ) {
        /*
         * TODO: only perform requests when from download manager
         * or when from browser for preview and selected chapter matches
         */
        this.requestOptions.headers.set( 'x-referer', payload.referer );
        let promise = super._handleConnectorURI( payload.url );
        this.requestOptions.headers.delete( 'x-referer' );
        return promise;
    }
}
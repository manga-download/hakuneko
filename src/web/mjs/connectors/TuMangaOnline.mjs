import Connector from '../engine/Connector.mjs';

export default class TuMangaOnline extends Connector {

    constructor() {
        super();
        super.id = 'tumangaonline';
        super.label = 'TuMangaOnline';
        this.tags = [ 'manga', 'spanish' ];
        this.url = 'https://tmofans.com';
        this.requestOptions.headers.set('x-referer', this.url);
    }

    async _initializeConnector() {
        await super._initializeConnector();
        await this.wait(2500);
    }

    async _getMangas() {
        let request = new Request('http://cdn.hakuneko.download/' + this.id + '/mangas.json', this.requestOptions);
        let response = await fetch(request);
        return await response.json();
    }

    async _getChapters(manga) {
        let script = `
            var _0xf99a=['wqHDksKK','w4Q0wqXDvQ==','w51Ow6hk','RlbCiMKrPQ==','w7YCOsKpXQ==','HcOcw4JSZw==','aiDDvw==','w6PCoUzDmGDChBHDvsOX','S8KhEMKhwpE=','BELDlMKhw7ICwprCgy/CscKiBcKjwr3CvUPDgnI=','w7PCm0PDs2k=','wq9DWsO8eQ==','esOjwqNAw6gd','wr7Cg2oU','wplMwoLDpMOH','w6PDtyPDgQg=','wqckw6FqJQ==','w7gxDsKcYQ==','Zl3CjRMm','wpnDu1PClCw=','YCvDljrDlA==','SwTDngLDhA==','wqTDvcO6wqc2woo=','RTfDqjfDuA==','w4wUYl3CkQ==','Tz4HdkstLTXCnBBqw7bDo1jDiMKVTMODwp3DscKvSQMgYW1Iw5xsHcKiw47Cjkhpw6skw6txbHRlOk/DsU0=','QMOowoVyw6U=','ZMKXw5I3dUPDhcOReMK2','wrpvwoXDk8O0','M1pNw7dWwqvCgFRFM8KYOywJwqQGNsOWwq/Du8Oxw7zDgyHDssOMwojCozPCnRvCsVrCkTxyX8KTw4PCsRDDkcKjR8OWwr/Dj0UlwqXCvDsRR24Rw4zDsQYlGMOSXMKUW8OfwpA=','woPDqcKUwqk5','cwlWIXF5w4zDt8Ko','wpXDo1jCvDs=','elTDoT7CnFVYw5XDgMOvwrXClVxUwrNKWsOcY8KAXwfDlUVkw6xgwow/w5MeJnnCvMK4woHCu8K4MQN2w5QZeMKhK8KWe8K1EQcMwqbCnMOLwpFDw4bCvg==','EXjDm8KewqU=','KxHChcKYIw==','WcKuw4k2Ug==','wo4Uw4JpBA==','wq8Nw4J5w4o=','ckXCoCcZ','ByJDw4Q1','w5lKJg==','w5ccNsKkf8OqbDc=','woXCnDnDg8Oj','wooSw7R2C8K0Wg==','wr40RgZ9acKmwpRvw6/CocOEUcOY','YSjDoTI=','wpctw6tZ','RsOyUzg=','w6Y/wpXDnMK8','wqE+w7ZMw7Y=','wobDssOhwp0X'];(function(_0x181db3,_0x322917){var _0xb6eaf3=function(_0x53cd23){while(--_0x53cd23){_0x181db3['push'](_0x181db3['shift']());}};_0xb6eaf3(++_0x322917);}(_0xf99a,0x1b5));var _0x2531=function(_0x181db3,_0x322917){_0x181db3=_0x181db3-0x0;var _0xb6eaf3=_0xf99a[_0x181db3];if(_0x2531['InzVTi']===undefined){(function(){var _0x55371a=function(){var _0x192e9f;try{_0x192e9f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x518dc3){_0x192e9f=window;}return _0x192e9f;};var _0x263b64=_0x55371a();var _0x5d8663='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x263b64['atob']||(_0x263b64['atob']=function(_0x4cb241){var _0x2c7281=String(_0x4cb241)['replace'](/=+$/,'');for(var _0x5bc9b9=0x0,_0x13e27b,_0x2c05a2,_0x455c55=0x0,_0x44e961='';_0x2c05a2=_0x2c7281['charAt'](_0x455c55++);~_0x2c05a2&&(_0x13e27b=_0x5bc9b9%0x4?_0x13e27b*0x40+_0x2c05a2:_0x2c05a2,_0x5bc9b9++%0x4)?_0x44e961+=String['fromCharCode'](0xff&_0x13e27b>>(-0x2*_0x5bc9b9&0x6)):0x0){_0x2c05a2=_0x5d8663['indexOf'](_0x2c05a2);}return _0x44e961;});}());var _0x32b002=function(_0x170b10,_0x322917){var _0xf88213=[],_0x321b91=0x0,_0x36edc8,_0x22c541='',_0xac33d3='';_0x170b10=atob(_0x170b10);for(var _0x5aa6d2=0x0,_0x4d7c4c=_0x170b10['length'];_0x5aa6d2<_0x4d7c4c;_0x5aa6d2++){_0xac33d3+='%'+('00'+_0x170b10['charCodeAt'](_0x5aa6d2)['toString'](0x10))['slice'](-0x2);}_0x170b10=decodeURIComponent(_0xac33d3);for(var _0xd2b31e=0x0;_0xd2b31e<0x100;_0xd2b31e++){_0xf88213[_0xd2b31e]=_0xd2b31e;}for(_0xd2b31e=0x0;_0xd2b31e<0x100;_0xd2b31e++){_0x321b91=(_0x321b91+_0xf88213[_0xd2b31e]+_0x322917['charCodeAt'](_0xd2b31e%_0x322917['length']))%0x100;_0x36edc8=_0xf88213[_0xd2b31e];_0xf88213[_0xd2b31e]=_0xf88213[_0x321b91];_0xf88213[_0x321b91]=_0x36edc8;}_0xd2b31e=0x0;_0x321b91=0x0;for(var _0x587f02=0x0;_0x587f02<_0x170b10['length'];_0x587f02++){_0xd2b31e=(_0xd2b31e+0x1)%0x100;_0x321b91=(_0x321b91+_0xf88213[_0xd2b31e])%0x100;_0x36edc8=_0xf88213[_0xd2b31e];_0xf88213[_0xd2b31e]=_0xf88213[_0x321b91];_0xf88213[_0x321b91]=_0x36edc8;_0x22c541+=String['fromCharCode'](_0x170b10['charCodeAt'](_0x587f02)^_0xf88213[(_0xf88213[_0xd2b31e]+_0xf88213[_0x321b91])%0x100]);}return _0x22c541;};_0x2531['EkWUTI']=_0x32b002;_0x2531['ONmhZM']={};_0x2531['InzVTi']=!![];}var _0x24a368=_0x2531['ONmhZM'][_0x181db3];if(_0x24a368===undefined){if(_0x2531['DzxCOL']===undefined){_0x2531['DzxCOL']=!![];}_0xb6eaf3=_0x2531['EkWUTI'](_0xb6eaf3,_0x322917);_0x2531['ONmhZM'][_0x181db3]=_0xb6eaf3;}else{_0xb6eaf3=_0x24a368;}return _0xb6eaf3;};new Promise(_0x268333=>{var _0x5104b9={};_0x5104b9[_0x2531('0x0','5Bu)')]=_0x2531('0x1','wmMQ');_0x5104b9[_0x2531('0x2','5Bu)')]=function(_0x572de0,_0x5988c5){return _0x572de0(_0x5988c5);};_0x5104b9[_0x2531('0x3','xWNr')]=_0x2531('0x4','x#4i');_0x5104b9[_0x2531('0x5','@b[7')]=_0x2531('0x6','11Nr');_0x5104b9[_0x2531('0x7','7A)@')]=_0x2531('0x8','c7$#');_0x5104b9[_0x2531('0x9',']K2j')]=_0x2531('0xa','N31(');_0x5104b9[_0x2531('0xb','6l)T')]=_0x2531('0xc','Ai(8');_0x5104b9[_0x2531('0xd','Q0$j')]=function(_0xbbe93e,_0x25ea24){return _0xbbe93e<_0x25ea24;};_0x5104b9[_0x2531('0xe','5G3p')]=function(_0x106e5e,_0x8d1eea){return _0x106e5e+_0x8d1eea;};_0x5104b9[_0x2531('0xf','11Nr')]=function(_0x3392a4,_0x5c5893){return _0x3392a4+_0x5c5893;};_0x5104b9[_0x2531('0x10','#e8U')]=function(_0x4a663f,_0x20de99,_0x91d245){return _0x4a663f(_0x20de99,_0x91d245);};let _0x50a415={};_0x50a415[_0x5104b9[_0x2531('0x11','570D')]]=[..._0x5104b9[_0x2531('0x12','Z34u')]($,_0x5104b9[_0x2531('0x13','CAag')])][_0x2531('0x14','ZKb]')](_0xdc5cd5=>$(_0xdc5cd5)[_0x2531('0x15','b)]P')]()[_0x2531('0x16','M$wU')]()[_0x2531('0x17','#e8U')](_0x2531('0x18','B8Lh'))[_0x2531('0x19','5Bu)')]('h4')[_0x2531('0x1a','570D')]()[_0x2531('0x1b',']DD#')]());_0x50a415[_0x5104b9[_0x2531('0x1c','qFND')]]=[..._0x5104b9[_0x2531('0x1d','570D')]($,_0x5104b9[_0x2531('0x1e','wmMQ')])][_0x2531('0x1f',']K2j')](_0x372241=>_0x372241[_0x2531('0x20','qFND')][_0x2531('0x21','0lyl')]());_0x50a415[_0x5104b9[_0x2531('0x22','1zLP')]]=[..._0x5104b9[_0x2531('0x23','b)]P')]($,_0x5104b9[_0x2531('0x24','C3dT')])][_0x2531('0x25','5Bu)')](_0x1932f3=>_0x1932f3[_0x2531('0x26','k&C!')][_0x2531('0x27','%cBN')](new RegExp(_0x2531('0x28','Q0$j')))[0x1]);let _0x269600=[];for(let _0x48d99b=0x0;_0x5104b9[_0x2531('0x29','k&C!')](_0x48d99b,_0x50a415[_0x5104b9[_0x2531('0x2a','z[Gi')]][_0x2531('0x2b','@b[7')]);_0x48d99b++){_0x269600[_0x2531('0x2c',']Gwq')]({'id':_0x48d99b,'title':_0x5104b9[_0x2531('0x2d','7A)@')](_0x5104b9[_0x2531('0x2e','sdDR')](_0x5104b9[_0x2531('0x2f','#e8U')](_0x50a415[_0x5104b9[_0x2531('0x30','b)]P')]][_0x48d99b],'\x20['),_0x50a415[_0x5104b9[_0x2531('0x31','Z34u')]][_0x48d99b]),']'),'language':_0x50a415[_0x5104b9[_0x2531('0x32','6l)T')]][_0x48d99b]});}_0x5104b9[_0x2531('0x33','5Bu)')](setTimeout,()=>_0x268333(_0x269600),0x1388);});
        `;
        let request = new Request(this.url + manga.id, this.requestOptions);
        return await Engine.Request.fetchUI(request, script);
    }

    async _getChapterLink(chapter) {
        let script = `
            window['chapter'] = ${chapter.id};
            var _0x2aad=['wrx7wqTDrcK1','w4pnw4TDnFs=','Z8KPWhQZ','YRcEw7N8','XAoXw4rDmQ==','w5nDmQBCwpBvTzYGR8O1wqIIZikAIChyw750LnNnS2nCrcOCfMO3wpTCkBzDp8OZw5/DnW/DuhPDpX7CghRTSRDDow==','TWoSF1Qaw7k=','SykTw5nDvA==','wqVfwrDDo8Ko','c8KgTB0p','wrnCpiEZP8OgH8OQw6M=','TcKWwpYDcg==','w71qwoAawpjCqsOH','w7TDpQY1wrI=','wpxowpvDv8Og','wqx1DsKGZcK5KcKgwrfCrMO4JTrDvAYk','wp4Iw6gVw4w=','w4TCoMKsUQ==','wqrCgiDDnQ==','UH7DrcOswoE=','w69Pw57Di1Q=','wo91wqHDhg==','c8KISg==','WzAZw5nDskUZ','DiARwqjDkQ==','AcKYw4DCo2rClEs=','w4c+wrvDpcKz'];(function(_0x4bf6cf,_0x3c9045){var _0x32dcb7=function(_0x23468a){while(--_0x23468a){_0x4bf6cf['push'](_0x4bf6cf['shift']());}};_0x32dcb7(++_0x3c9045);}(_0x2aad,0x131));var _0x3ce5=function(_0x4bf6cf,_0x3c9045){_0x4bf6cf=_0x4bf6cf-0x0;var _0x32dcb7=_0x2aad[_0x4bf6cf];if(_0x3ce5['ayFRWq']===undefined){(function(){var _0x3ba91d=function(){var _0x350d7d;try{_0x350d7d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x578813){_0x350d7d=window;}return _0x350d7d;};var _0x4986d4=_0x3ba91d();var _0x5544d6='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x4986d4['atob']||(_0x4986d4['atob']=function(_0x4b1336){var _0x408ac2=String(_0x4b1336)['replace'](/=+$/,'');for(var _0x184ae4=0x0,_0x59b28f,_0x1d8235,_0x1110fc=0x0,_0x3c4ecd='';_0x1d8235=_0x408ac2['charAt'](_0x1110fc++);~_0x1d8235&&(_0x59b28f=_0x184ae4%0x4?_0x59b28f*0x40+_0x1d8235:_0x1d8235,_0x184ae4++%0x4)?_0x3c4ecd+=String['fromCharCode'](0xff&_0x59b28f>>(-0x2*_0x184ae4&0x6)):0x0){_0x1d8235=_0x5544d6['indexOf'](_0x1d8235);}return _0x3c4ecd;});}());var _0x57ba44=function(_0x3c589b,_0x3c9045){var _0x2678a9=[],_0x3d5b17=0x0,_0x2f53e6,_0xc12231='',_0x4867fd='';_0x3c589b=atob(_0x3c589b);for(var _0x52cbe4=0x0,_0x85f307=_0x3c589b['length'];_0x52cbe4<_0x85f307;_0x52cbe4++){_0x4867fd+='%'+('00'+_0x3c589b['charCodeAt'](_0x52cbe4)['toString'](0x10))['slice'](-0x2);}_0x3c589b=decodeURIComponent(_0x4867fd);for(var _0x62e6d4=0x0;_0x62e6d4<0x100;_0x62e6d4++){_0x2678a9[_0x62e6d4]=_0x62e6d4;}for(_0x62e6d4=0x0;_0x62e6d4<0x100;_0x62e6d4++){_0x3d5b17=(_0x3d5b17+_0x2678a9[_0x62e6d4]+_0x3c9045['charCodeAt'](_0x62e6d4%_0x3c9045['length']))%0x100;_0x2f53e6=_0x2678a9[_0x62e6d4];_0x2678a9[_0x62e6d4]=_0x2678a9[_0x3d5b17];_0x2678a9[_0x3d5b17]=_0x2f53e6;}_0x62e6d4=0x0;_0x3d5b17=0x0;for(var _0x4514d0=0x0;_0x4514d0<_0x3c589b['length'];_0x4514d0++){_0x62e6d4=(_0x62e6d4+0x1)%0x100;_0x3d5b17=(_0x3d5b17+_0x2678a9[_0x62e6d4])%0x100;_0x2f53e6=_0x2678a9[_0x62e6d4];_0x2678a9[_0x62e6d4]=_0x2678a9[_0x3d5b17];_0x2678a9[_0x3d5b17]=_0x2f53e6;_0xc12231+=String['fromCharCode'](_0x3c589b['charCodeAt'](_0x4514d0)^_0x2678a9[(_0x2678a9[_0x62e6d4]+_0x2678a9[_0x3d5b17])%0x100]);}return _0xc12231;};_0x3ce5['lHKDkC']=_0x57ba44;_0x3ce5['BFhaUY']={};_0x3ce5['ayFRWq']=!![];}var _0x54a2f6=_0x3ce5['BFhaUY'][_0x4bf6cf];if(_0x54a2f6===undefined){if(_0x3ce5['BWJjdN']===undefined){_0x3ce5['BWJjdN']=!![];}_0x32dcb7=_0x3ce5['lHKDkC'](_0x32dcb7,_0x3c9045);_0x3ce5['BFhaUY'][_0x4bf6cf]=_0x32dcb7;}else{_0x32dcb7=_0x54a2f6;}return _0x32dcb7;};new Promise((_0x5b0470,_0x3b5397)=>{var _0x3a81b6={};_0x3a81b6[_0x3ce5('0x0','anYq')]=function(_0x21fda8,_0x256e2b){return _0x21fda8(_0x256e2b);};_0x3a81b6[_0x3ce5('0x1','etRC')]=_0x3ce5('0x2','R*lm');_0x3a81b6[_0x3ce5('0x3','*O[l')]=_0x3ce5('0x4','FmZr');_0x3a81b6[_0x3ce5('0x5','BfEO')]=function(_0xa127a7,_0x5be7a1){return _0xa127a7(_0x5be7a1);};_0x3a81b6[_0x3ce5('0x6','Y8pC')]=_0x3ce5('0x7','tnzb');_0x3a81b6[_0x3ce5('0x8','3gQe')]=function(_0x250362,_0x1968c1,_0xea8d8){return _0x250362(_0x1968c1,_0xea8d8);};let _0x1b2bcf=$[_0x3ce5('0x9','0NFz')];$[_0x3ce5('0xa','Eold')]=_0x19a51d=>{var _0x4c4d19={};_0x4c4d19[_0x3ce5('0xb','D[#B')]=function(_0x533e95,_0x308b10){return _0x3a81b6.IUpYA(_0x533e95,_0x308b10);};if(new RegExp(_0x3a81b6[_0x3ce5('0xc','L!Pi')])[_0x3ce5('0xd','Y8pC')](_0x19a51d[_0x3ce5('0xe','%6Ys')])){_0x19a51d[_0x3ce5('0xf','XrV$')]=_0x95670c=>{_0x3a81b6[_0x3ce5('0x10','YI10')](_0x5b0470,_0x95670c[_0x3ce5('0x11','UP^5')](_0x3a81b6[_0x3ce5('0x12','&e!6')],_0x3a81b6[_0x3ce5('0x13','anYq')]));};_0x19a51d[_0x3ce5('0x14','rI$f')]=(_0x480eab,_0x11a786,_0x399704)=>{_0x4c4d19[_0x3ce5('0x15','etRC')](_0x3b5397,_0x399704);};}_0x3a81b6[_0x3ce5('0x16','QaaK')](_0x1b2bcf,_0x19a51d);};_0x3a81b6[_0x3ce5('0x17','XrV$')](setTimeout,()=>$(_0x3ce5('0x18','BfEO'))[window[_0x3ce5('0x19','#ge1')]][_0x3ce5('0x1a','XrV$')](),0x9c4);});
        `;
        let request = new Request(this.url + chapter.manga.id, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        return new URL(data, request.url);
    }

    async _getPages(chapter) {
        let script = `
            var _0x162a=['wpNlw7DCjBg=','Xy7DhGETwojDim0qHitEXnxtCcO/w5zCpzbDqyLCocKBw7MQwqHDqMK5IMOOOB7DnGbCj8Kt','MmzClw==','w6F9wpc=','KDbDtxoI'];(function(_0x5765ad,_0xde9553){var _0x418e86=function(_0x4918aa){while(--_0x4918aa){_0x5765ad['push'](_0x5765ad['shift']());}};_0x418e86(++_0xde9553);}(_0x162a,0xcc));var _0x38d7=function(_0x5765ad,_0xde9553){_0x5765ad=_0x5765ad-0x0;var _0x418e86=_0x162a[_0x5765ad];if(_0x38d7['rGfeHp']===undefined){(function(){var _0x312a92;try{var _0x57ee54=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x312a92=_0x57ee54();}catch(_0x31525d){_0x312a92=window;}var _0x150ca7='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x312a92['atob']||(_0x312a92['atob']=function(_0x4eb175){var _0x4eb8cb=String(_0x4eb175)['replace'](/=+$/,'');for(var _0x2c8b05=0x0,_0x22ca98,_0x57797a,_0x5c09aa=0x0,_0x2c6003='';_0x57797a=_0x4eb8cb['charAt'](_0x5c09aa++);~_0x57797a&&(_0x22ca98=_0x2c8b05%0x4?_0x22ca98*0x40+_0x57797a:_0x57797a,_0x2c8b05++%0x4)?_0x2c6003+=String['fromCharCode'](0xff&_0x22ca98>>(-0x2*_0x2c8b05&0x6)):0x0){_0x57797a=_0x150ca7['indexOf'](_0x57797a);}return _0x2c6003;});}());var _0x24fb66=function(_0x18f6cc,_0xde9553){var _0xe4cb6f=[],_0x169475=0x0,_0x12e2d6,_0x39a3d7='',_0x5f225a='';_0x18f6cc=atob(_0x18f6cc);for(var _0x118c26=0x0,_0x336371=_0x18f6cc['length'];_0x118c26<_0x336371;_0x118c26++){_0x5f225a+='%'+('00'+_0x18f6cc['charCodeAt'](_0x118c26)['toString'](0x10))['slice'](-0x2);}_0x18f6cc=decodeURIComponent(_0x5f225a);for(var _0x3a712e=0x0;_0x3a712e<0x100;_0x3a712e++){_0xe4cb6f[_0x3a712e]=_0x3a712e;}for(_0x3a712e=0x0;_0x3a712e<0x100;_0x3a712e++){_0x169475=(_0x169475+_0xe4cb6f[_0x3a712e]+_0xde9553['charCodeAt'](_0x3a712e%_0xde9553['length']))%0x100;_0x12e2d6=_0xe4cb6f[_0x3a712e];_0xe4cb6f[_0x3a712e]=_0xe4cb6f[_0x169475];_0xe4cb6f[_0x169475]=_0x12e2d6;}_0x3a712e=0x0;_0x169475=0x0;for(var _0x1d4cb5=0x0;_0x1d4cb5<_0x18f6cc['length'];_0x1d4cb5++){_0x3a712e=(_0x3a712e+0x1)%0x100;_0x169475=(_0x169475+_0xe4cb6f[_0x3a712e])%0x100;_0x12e2d6=_0xe4cb6f[_0x3a712e];_0xe4cb6f[_0x3a712e]=_0xe4cb6f[_0x169475];_0xe4cb6f[_0x169475]=_0x12e2d6;_0x39a3d7+=String['fromCharCode'](_0x18f6cc['charCodeAt'](_0x1d4cb5)^_0xe4cb6f[(_0xe4cb6f[_0x3a712e]+_0xe4cb6f[_0x169475])%0x100]);}return _0x39a3d7;};_0x38d7['CouuEs']=_0x24fb66;_0x38d7['czjIKO']={};_0x38d7['rGfeHp']=!![];}var _0x2b889e=_0x38d7['czjIKO'][_0x5765ad];if(_0x2b889e===undefined){if(_0x38d7['csrInd']===undefined){_0x38d7['csrInd']=!![];}_0x418e86=_0x38d7['CouuEs'](_0x418e86,_0xde9553);_0x38d7['czjIKO'][_0x5765ad]=_0x418e86;}else{_0x418e86=_0x2b889e;}return _0x418e86;};new Promise(_0x23386e=>{var _0xb57a9d={};_0xb57a9d[_0x38d7('0x0','X83d')]=function(_0x39a3d7,_0x5f225a,_0x118c26){return _0x39a3d7(_0x5f225a,_0x118c26);};_0xb57a9d[_0x38d7('0x1','4Q0u')](setTimeout,()=>_0x23386e([...$(_0x38d7('0x2','w@8i'))][_0x38d7('0x3','rU)[')](_0x392ddc=>_0x392ddc[_0x38d7('0x4','K&O2')])),0x9c4);});
        `;
        let uri = await this._getChapterLink(chapter);
        let request = new Request(uri, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script);
        return data.map(img => this.createConnectorURI({
            url: this.getAbsolutePath(img, request.url),
            referer: request.url
        }));
    }

    _handleConnectorURI( payload ) {
        /*
         * TODO: only perform requests when from download manager
         * or when from browser for preview and selected chapter matches
         */
        this.requestOptions.headers.set( 'x-referer', payload.referer );
        let promise = super._handleConnectorURI( payload.url );
        this.requestOptions.headers.delete( 'x-referer' );
        return promise;
    }
}
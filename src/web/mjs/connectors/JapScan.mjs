import Connector from '../engine/Connector.mjs';
import Manga from '../engine/Manga.mjs';

export default class JapScan extends Connector {

    constructor() {
        super();
        super.id = 'japscan';
        super.label = 'JapScan';
        this.tags = [ 'manga', 'french' ];
        this.url = 'https://www.japscan.co';
        this.urlCDN = 'https://c.japscan.co/';

        this.config = {
            throttle: {
                label: 'Throttle Requests [ms]',
                description: 'Enter the timespan in [ms] to delay consecuitive HTTP requests.\nThe image download may fail for to many consecuitive requests.',
                input: 'numeric',
                min: 1000,
                max: 7500,
                value: 1500
            }
        };
    }

    async _getMangaFromURI(uri) {
        let request = new Request(uri, this.requestOptions);
        let data = await this.fetchDOM(request, 'div#main div.card h1');
        let id = uri.pathname + uri.search;
        let title = data[0].textContent.replace(/^[mM]anga\s*/, '').trim();
        return new Manga(this, id, title);
    }

    async _getMangas() {
        let mangaList = [];
        let request = new Request(new URL('/mangas/1', this.url), this.requestOptions);
        let data = await this.fetchDOM(request, 'div.card ul.pagination li:last-of-type a');
        let pageCount = parseInt(data[0].text.trim());
        for(let page = 1; page <= pageCount; page++) {
            let mangas = await this._getMangasFromPage(page);
            mangaList.push(...mangas);
        }
        return mangaList;
    }

    async _getMangasFromPage(page) {
        let request = new Request(new URL('/mangas/' + page, this.url), this.requestOptions);
        let data = await this.fetchDOM(request, 'div.card div p.p-1 a', 5);
        return data.map(element => {
            return {
                id: this.getRootRelativeOrAbsoluteLink(element, request.url),
                title: element.text.trim()
            };
        });
    }

    async _getChapters(manga) {
        let request = new Request(new URL(manga.id, this.url), this.requestOptions);
        let data = await this.fetchDOM(request, 'div.card div#chapters_list div.chapters_list a');
        return data.map(element => {
            this.cfMailDecrypt(element);
            return {
                id: this.getRootRelativeOrAbsoluteLink(element, request.url),
                title: element.text.replace(manga.title, '').replace('Scan', '').replace('VF', '').trim(),
                language: ''
            };
        });
    }

    async _getPages(chapter) {
        let script = `
            window['useBruteForce'] = true;
            const _0x259f=['w7nCikTDiko=','VMKWwqY2w5A=','w6/CnlZUw77Csg==','w6cZwplOwrk=','NsOWw6Q4ScOew6ke','w69fwpQ0w4M=','NQcfw6DDpA==','w49EwrYEw5w=','FSDDiiLDgA==','RcKlw54JNA==','SzXDksKgDg==','w63CiGLDgms=','ScOJG8Ocwr0=','XsKUAMO7Kw==','U8O5OMORwoo=','XsOOLsOSwrc=','RsO4w50ZZw==','wopQDiPCjw==','w5nCpWDDhnc=','wpPDrsKgFMKn','f1oNw6XCng==','wr4/ThxJ','QsKsw4VOwro=','SMKkw4cFPxXDjcOmwqzDg8KVwp8=','TcK4w4DDgcKn','w5TDvcOFworCsg==','GlbDosK7wrM=','wrExw5Ms','wrACw7g9LQ==','wqgMw7wgHA==','wp1Xw49Sw6g=','a8KZw7jDvsK+','IMOJVcK5Eg==','w5HDiMOLwrLCvQ==','w6LCrnvDi28=','N8Ogw5I/','wpZNw7EfP8OAw7vDvcOlwrYaw6lmw5PDuQJOXSrDhMOIdsOGwpcWwr/DocOhwp0+OMONwrAHwpx2asKtb8ODw5o=','LsO9w5g=','f8KAAsOEPw==','R8OBw7Y1ew==','w4s9wqvChsKg','BSXCpw3DoA==','AsKbw6wWHw==','NG7DgsKNwoI=','cTdpw6RZ','w4gtwqhRwpM=','K1vDncOKwo0=','w4/CtXnDnWo=','w5fCrHjDuGQ=','w5JzC8Ojw5U=','w7xCw6vDtcOL','wrErw4E7Pw==','LsO6bsKrMQ==','LinCkMOOwq4=','w5ZEw47Dm8On','NsOBw6M+wq8=','wq/DpMKs','wottTcKhw4Nmwo7Dpg==','MQjCpQnDvA==','YCZYw4db','w5dYaD/CrA==','w5pgJMO7w5E=','Wlw6W0M=','CcKUw6kiLw==','G8OCK8OAw5Y=','WsKcAcOCLA==','woPCr8OJwoHCpA==','wprDlDVABA==','dcOpN8OHwp0=','wqs9w7w0Ng==','woTDmMKsJcK5','w6nCuGRPw5Y=','w4JXw4TDlcOD','wrlFw49Jw4k=','EXzDisObwpY=','w5fDhsOswrPCmQ==','X8Kcw6Fbwrc=','w7XDk8OXwoNC','PRoKw4XDhQ==','w6onwpM=','woh2T8KDw6I=','X8KBw53CiMKkwrLCrMO+Ow==','wqcWahJZ','woAlw646Eg==','wpPDlApUIw==','w6fDnMOswoLCjQ==','UwIjwpJo','w54FwobCmMKW','Jm7DssO3wp0=','wrVCw7YENQ==','w6FIwogPw6w=','FAHCj8OQwoY=','A8Kow4kNPA==','wrLDhAJaDg==','w6c2wrVTwr0=','RsOII8Omwqo=','w7Vpw6zDuMOH','wq4qw5guNg0=','IsK8wpTDkcOy','bCEIwqxS','w4g3worCo8Kf','w6/DiMOhwp3CtQ==','wrQkw4E/GA==','w4UvRA==','fjzDgsKVGw==','Ljk1w7HDuA==','w5oUwoTCqcKj','w5xWw7LDi8OxBMK2wpQ=','DcO+w6gEwpI=','woPDqBNIGw==','wrpbE8Kbw5w=','UMKxwq4ow4PCnw==','LsOqw48FwogqZnPDg8OU','HcKrwqTDqcOcVCvCvknCo8KHwqTDuw==','DCHChQ7DvA==','NDfCpMOZwpw=','wrRzw68ZIw==','DsOFFsOyw6Q=','wqLDpsKoCsK5IQtY','wpxVw5ttw7vDrw==','UMOSJsOqwpU=','aCRmw7lU','wpfDuxlGPw==','w5hEw6/Dt8O4','w6/DlMOWwr5C','w49wZMO9woA=','w6/DvcO2wrfCvQ==','w7ZDw6jDssOJ','w70JwpvCkcKj','GXXDgMKbwoc=','wozDgsKcMMKO','Nl/DicO2woM=','wp1tw7Zdw60=','EkLDucKtwrM=','w6YTwodOwqA=','wrRxwqfCp8Kx','w4LCvcKyL8O/','FVXDkMOOwq0=','wrjCvcORwpLClQ==','w6TCunDDoVdwwrkkw4pWPsOPDVMaLg==','wrR7w4xfw7U=','wq3DhcKgMcK8','w5dnQT7Cmg==','w4RFw6PDhQ==','wq5EIsKUw7k=','w6jDl8Onwp1Y','Y3cIw7PCtw==','w4fDocO3wqjCrw==','Pi7CvADDuA==','w6d4w7/Dp8Ow','w6VNO8Obw4M=','SMKmBMOSLA==','wq/DuwVYDQ==','VCMYwpxSIsOTw70=','w7zDncO4wqp+','wr4QYgFN','NcOqw5g4woU=','XcK4w7NUwrk=','JwDDqCfDvcKHwpIC','wrRCw7QpEQ==','UcKJw4/DnMK+','w5pWZwvCqA==','D3HDssOcwroDw5FMwqpnLVM=','ZMK/wrckw54=','w4DCqH7DuF0=','w700wolTwrg=','w7xAF8OIw6E=','w6BRw4HDpsOx','w7tswoUXw5s=','w54mwr1dwqM=','w4N1wpMQw60=','TgDDnMKYAQ==','TsOiw7knfQ==','wpJcFQbCuA==','wrQiw4Y=','Fy89w6DDvA==','PcORe8K5FA==','w4dFw4LDqMOk','w70awrdxwoY=','w4FRSsOvwqo=','GsK9w6Q2Cg==','YwFow6VJ','UWItw5PCrw==','wpdcw4Jqw7w=','woQfXjht','PMO8w7wdwpg=','w4QMwrzCosKY','wpdOw6kgJA==','w77DnsOHwrY=','Uwpyw7tY','SsKLMcO0Dg==','Di3CjcOywr0=','b8Otw40Bfg==','O8O6w50Awpc=','bWgZR1s=','wpRUAMKOw4Q=','HTE7w6TDkg==','wrw2w40IMg==','OcO+aMKrCA==','w7fCllbDlVk=','IWbDgMKNwps=','w7tmwpMGw7E=','wqFZJcKxw44=','w7VWCcO9w44=','woRyX8KCw4E=','MMOnw68zwq4=','w5scwqkQwog6cijCuhXDr8KOw48=','WMKaBcO3NG1ww4vCgm/Ckn1KU8OaA8KMwoHDhnZKQxnCvgFGDC7Cj8KwwpHDqXvCuMOYNjPCnRo+w57CjMO4w41wSWvChsOYIxAhwp3ClsK8','asKYw7NJwqo=','fcOFw6UCfA==','bcK7wqodw4M=','wpXDkzFeGA==','wqkZw647OA==','IBgbw6PDkg==','w59Fw6U=','PMOHMcO3w5Y=','XVwIw5bCrA==','w5s9wpnClcK8','w48UwqtWwoU0cTk=','VMOqw6MnXg==','wr4ew5s1Mg==','b8KSH8OxK20p','PsKqw4EPKw==','JcKPwpjDqMOT','EAUpw7fDpU/CoMKywrlXH2fChw==','OAvCn8OrwqfCpsO1wpo=','wowNUiFK','ecOHHTAm','wqlSw6whBQ==','UThZw5hU'];(function(_0x548048,_0x259f16){const _0x331c55=function(_0x4253c2){while(--_0x4253c2){_0x548048['push'](_0x548048['shift']());}};_0x331c55(++_0x259f16);}(_0x259f,0x1c7));const _0x331c=function(_0x548048,_0x259f16){_0x548048=_0x548048-0x0;let _0x331c55=_0x259f[_0x548048];if(_0x331c['uaJRAN']===undefined){(function(){let _0x419bce;try{const _0x2a0582=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x419bce=_0x2a0582();}catch(_0x108d12){_0x419bce=window;}const _0x4839bf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x419bce['atob']||(_0x419bce['atob']=function(_0x1815f2){const _0x4ee852=String(_0x1815f2)['replace'](/=+$/,'');let _0x607bad='';for(let _0x4721ae=0x0,_0x5553e2,_0x5c450b,_0x47e3e6=0x0;_0x5c450b=_0x4ee852['charAt'](_0x47e3e6++);~_0x5c450b&&(_0x5553e2=_0x4721ae%0x4?_0x5553e2*0x40+_0x5c450b:_0x5c450b,_0x4721ae++%0x4)?_0x607bad+=String['fromCharCode'](0xff&_0x5553e2>>(-0x2*_0x4721ae&0x6)):0x0){_0x5c450b=_0x4839bf['indexOf'](_0x5c450b);}return _0x607bad;});}());const _0x563285=function(_0x1ecfae,_0x4c8357){let _0x2459d7=[],_0x20c49b=0x0,_0x4bdeb5,_0x2b6e81='',_0x1ff888='';_0x1ecfae=atob(_0x1ecfae);for(let _0x343891=0x0,_0x3f5e79=_0x1ecfae['length'];_0x343891<_0x3f5e79;_0x343891++){_0x1ff888+='%'+('00'+_0x1ecfae['charCodeAt'](_0x343891)['toString'](0x10))['slice'](-0x2);}_0x1ecfae=decodeURIComponent(_0x1ff888);let _0x43ed5b;for(_0x43ed5b=0x0;_0x43ed5b<0x100;_0x43ed5b++){_0x2459d7[_0x43ed5b]=_0x43ed5b;}for(_0x43ed5b=0x0;_0x43ed5b<0x100;_0x43ed5b++){_0x20c49b=(_0x20c49b+_0x2459d7[_0x43ed5b]+_0x4c8357['charCodeAt'](_0x43ed5b%_0x4c8357['length']))%0x100;_0x4bdeb5=_0x2459d7[_0x43ed5b];_0x2459d7[_0x43ed5b]=_0x2459d7[_0x20c49b];_0x2459d7[_0x20c49b]=_0x4bdeb5;}_0x43ed5b=0x0;_0x20c49b=0x0;for(let _0x23c08f=0x0;_0x23c08f<_0x1ecfae['length'];_0x23c08f++){_0x43ed5b=(_0x43ed5b+0x1)%0x100;_0x20c49b=(_0x20c49b+_0x2459d7[_0x43ed5b])%0x100;_0x4bdeb5=_0x2459d7[_0x43ed5b];_0x2459d7[_0x43ed5b]=_0x2459d7[_0x20c49b];_0x2459d7[_0x20c49b]=_0x4bdeb5;_0x2b6e81+=String['fromCharCode'](_0x1ecfae['charCodeAt'](_0x23c08f)^_0x2459d7[(_0x2459d7[_0x43ed5b]+_0x2459d7[_0x20c49b])%0x100]);}return _0x2b6e81;};_0x331c['KrwHKj']=_0x563285;_0x331c['gKrPOr']={};_0x331c['uaJRAN']=!![];}const _0x4253c2=_0x331c['gKrPOr'][_0x548048];if(_0x4253c2===undefined){if(_0x331c['dxfFhS']===undefined){_0x331c['dxfFhS']=!![];}_0x331c55=_0x331c['KrwHKj'](_0x331c55,_0x259f16);_0x331c['gKrPOr'][_0x548048]=_0x331c55;}else{_0x331c55=_0x4253c2;}return _0x331c55;};new Promise((_0x27fb7b,_0x529866)=>{const _0x274345={};_0x274345[_0x331c('0x13','80AO')]=function(_0x4a9faf,_0x5955d8){return _0x4a9faf!==_0x5955d8;};_0x274345[_0x331c('0x7d','80AO')]=_0x331c('0x25','HM&x');_0x274345[_0x331c('0xc','u*wf')]=function(_0x35ff94,_0x13f253){return _0x35ff94(_0x13f253);};_0x274345[_0x331c('0x19','Iqr$')]=_0x331c('0x7b','D42P');_0x274345[_0x331c('0xd5','nKE0')]=_0x331c('0x90','G%z9');_0x274345[_0x331c('0xbd','EmSx')]=_0x331c('0x56','5QQD');_0x274345[_0x331c('0xd2','g0U2')]=_0x331c('0x3d','D42P');_0x274345[_0x331c('0x18','D42P')]=_0x331c('0x28','g0U2');_0x274345[_0x331c('0x44','gbq1')]=_0x331c('0xb3','HvAD');_0x274345[_0x331c('0x26','p%YP')]=function(_0x3f5283,_0x14803d){return _0x3f5283(_0x14803d);};_0x274345[_0x331c('0x50','p%YP')]=_0x331c('0xd4','Cw%(');_0x274345[_0x331c('0x88','iYj5')]=function(_0x2ad767,_0xa80651){return _0x2ad767===_0xa80651;};_0x274345[_0x331c('0x37','39x@')]=_0x331c('0x79','UZq0');_0x274345[_0x331c('0xb8','Xmp!')]=_0x331c('0x6c','t8R4');_0x274345[_0x331c('0x43','hB)U')]=_0x331c('0xe2','Cw%(');_0x274345[_0x331c('0x3','UZq0')]=_0x331c('0xdf','r8yU');_0x274345[_0x331c('0x31','vrAG')]=_0x331c('0x6f','I*Pf');_0x274345[_0x331c('0xf','YAIn')]=_0x331c('0x20','HvAD');_0x274345[_0x331c('0x34','G%z9')]=_0x331c('0x76',')s74');_0x274345[_0x331c('0xb','jxll')]=_0x331c('0xd3','r8yU');_0x274345[_0x331c('0x41','D3Lz')]=_0x331c('0xa7','iYj5');_0x274345[_0x331c('0x45','e(oM')]=_0x331c('0x7','2[9N');_0x274345[_0x331c('0x4c','2[9N')]=_0x331c('0xdc','e(oM');_0x274345[_0x331c('0x55',']VC6')]=_0x331c('0x1c','gbq1');_0x274345[_0x331c('0xbb','Iqr$')]=_0x331c('0x2a','g0U2');_0x274345[_0x331c('0xd7','e%ZA')]=function(_0x57e303,_0x13aec4){return _0x57e303<_0x13aec4;};_0x274345[_0x331c('0x5b','WVM%')]=_0x331c('0x74','e%ZA');_0x274345[_0x331c('0x8b','r8yU')]=function(_0x5e33ad,_0x5ea64e){return _0x5e33ad(_0x5ea64e);};_0x274345[_0x331c('0xb5','HM&x')]=function(_0x59fa7b,_0x2c557e){return _0x59fa7b(_0x2c557e);};_0x274345[_0x331c('0x92','D42P')]=_0x331c('0x83','p%YP');_0x274345[_0x331c('0x4e','M1Iw')]=_0x331c('0x7c','M1Iw');_0x274345[_0x331c('0x1d','5QQD')]=_0x331c('0x0','uAH6');_0x274345[_0x331c('0x1b','nKE0')]=_0x331c('0x3e',']VC6');_0x274345[_0x331c('0x3b','WFvy')]=_0x331c('0xe','gbq1');_0x274345[_0x331c('0x6b','HvAD')]=function(_0x17ad8e,_0x1f6686){return _0x17ad8e&&_0x1f6686;};_0x274345[_0x331c('0xd0','Sin3')]=function(_0x1435d7){return _0x1435d7();};_0x274345[_0x331c('0x38','HvAD')]=function(_0x4987aa,_0x41aa9d){return _0x4987aa&&_0x41aa9d;};_0x274345[_0x331c('0xc5','tX@H')]=_0x331c('0x66','HvAD');_0x274345[_0x331c('0xbe','g0U2')]=_0x331c('0xe5','jxll');_0x274345[_0x331c('0x8d','cmcJ')]=function(_0x422d0b){return _0x422d0b();};_0x274345[_0x331c('0x9c','Cw%(')]=function(_0x1f8eb1){return _0x1f8eb1();};_0x274345[_0x331c('0x48','pE0N')]=function(_0x4ae26f,_0x1146aa){return _0x4ae26f&&_0x1146aa;};_0x274345[_0x331c('0xd','^xsS')]=function(_0x23291d){return _0x23291d();};_0x274345[_0x331c('0x2e','&n!D')]=function(_0x6d88d7,_0x29f73e){return _0x6d88d7&&_0x29f73e;};_0x274345[_0x331c('0xde','I*Pf')]=_0x331c('0x29','UZq0');_0x274345[_0x331c('0xa1','g0U2')]=function(_0x457405,_0x558db7){return _0x457405===_0x558db7;};_0x274345[_0x331c('0x33','iYj5')]=_0x331c('0x5','G%z9');_0x274345[_0x331c('0x21','HvAD')]=_0x331c('0xe4',')s74');_0x274345[_0x331c('0x4a','ulxF')]=function(_0x5f45fc,_0x58b7a2){return _0x5f45fc(_0x58b7a2);};_0x274345[_0x331c('0xc3','Cw%(')]=_0x331c('0x75','g0U2');_0x274345[_0x331c('0x60','uAH6')]=_0x331c('0x9','%QfD');const _0x42883a=_0x274345;function _0x5afc13(){if(_0x42883a[_0x331c('0x32','r8yU')](_0x42883a[_0x331c('0x2b','Cw%(')],_0x42883a[_0x331c('0x80','39x@')])){map[keys[index]]=values[index];}else{_0x42883a[_0x331c('0x96','MFas')](_0x27fb7b,[...this[_0x42883a[_0x331c('0xa6','D3Lz')]][_0x42883a[_0x331c('0x8','r8yU')]]([_0x42883a[_0x331c('0x23','M1Iw')],'a',_0x42883a[_0x331c('0xd9','ulxF')]][_0x42883a[_0x331c('0xe3','gbq1')]]('\x20'))][_0x42883a[_0x331c('0x89','M1Iw')]](_0x862475=>_0x862475[_0x331c('0xdb','39x@')]));}}function _0x565a3e(){const _0x91967b={};_0x91967b[_0x331c('0xc7','hB)U')]=function(_0x398e0b,_0x5e4953){return _0x42883a[_0x331c('0xb0','YAIn')](_0x398e0b,_0x5e4953);};_0x91967b[_0x331c('0x69','I*Pf')]=_0x42883a[_0x331c('0x7a','e(oM')];_0x91967b[_0x331c('0x42','Sin3')]=function(_0x59389e,_0xd6af90){return _0x42883a[_0x331c('0x87','D42P')](_0x59389e,_0xd6af90);};_0x91967b[_0x331c('0xce','u*wf')]=_0x42883a[_0x331c('0xb6','WFvy')];_0x91967b[_0x331c('0xa5','5QQD')]=_0x42883a[_0x331c('0x52','MFas')];_0x91967b[_0x331c('0x8a','imP]')]=_0x42883a[_0x331c('0x1a','EmSx')];_0x91967b[_0x331c('0x9b','Sin3')]=_0x42883a[_0x331c('0xbf','I*Pf')];_0x91967b[_0x331c('0x5a','p%YP')]=_0x42883a[_0x331c('0x1','EmSx')];_0x91967b[_0x331c('0x77','&n!D')]=_0x42883a[_0x331c('0x3a','uAH6')];_0x91967b[_0x331c('0xab','Sin3')]=_0x42883a[_0x331c('0xcc','G%z9')];_0x91967b[_0x331c('0x35','G%z9')]=_0x42883a[_0x331c('0x95','fgMS')];_0x91967b[_0x331c('0xb1','tX@H')]=_0x42883a[_0x331c('0x1e','p%YP')];const _0x1e24ac=_0x91967b;let _0x41ce29=new this[_0x42883a[(_0x331c('0x6e','jxll'))]](this[_0x42883a[_0x331c('0xa4','UZq0')]][_0x42883a[_0x331c('0xcf','fgMS')]]([_0x42883a[_0x331c('0x24','5QQD')],_0x42883a[_0x331c('0xb2','sdWQ')],_0x42883a[_0x331c('0xc0','UZq0')]][_0x42883a[_0x331c('0xcb','HM&x')]]('\x20'))[_0x42883a[_0x331c('0x63','r8yU')]][_0x42883a[_0x331c('0x51','nKE0')]])[_0x42883a[_0x331c('0xba','vrAG')]][_0x42883a[_0x331c('0x8f','wx5u')]]('.')[_0x42883a[_0x331c('0x2f','gbq1')]]()[_0x42883a[_0x331c('0x5f','u*wf')]]('');let _0x47379d=new this[_0x42883a[(_0x331c('0x9a','39x@'))]](this[_0x42883a[_0x331c('0x5c','I*Pf')]][_0x42883a[_0x331c('0xc2','vrAG')]](_0x42883a[_0x331c('0xc6','g0U2')])[_0x42883a[_0x331c('0x1f','imP]')]])[_0x42883a[_0x331c('0x8c','I2aN')]][_0x42883a[_0x331c('0xca','ulxF')]]('.')[_0x42883a[_0x331c('0x40','vrAG')]]()[_0x42883a[_0x331c('0x10','G%z9')]]('');let _0x3ce772={};for(let _0x1dc263=0x0;_0x42883a[_0x331c('0x46','Cw%(')](_0x1dc263,_0x41ce29[_0x42883a[_0x331c('0x3c','g0U2')]]);_0x1dc263++){_0x3ce772[_0x41ce29[_0x1dc263]]=_0x47379d[_0x1dc263];}let _0x12d5bf=this[_0x42883a[_0x331c('0xac','WFvy')]][_0x42883a[_0x331c('0xa0','EmSx')]]([_0x42883a[_0x331c('0x71','g0U2')],_0x42883a[_0x331c('0xe1','ulxF')],_0x42883a[_0x331c('0x85','I*Pf')]][_0x42883a[_0x331c('0x7f','pE0N')]]('\x20'));_0x12d5bf=[..._0x12d5bf][_0x42883a[_0x331c('0x65','WFvy')]](_0x110443=>{if(_0x1e24ac[_0x331c('0x67',')s74')](_0x1e24ac[_0x331c('0x64','80AO')],_0x1e24ac[_0x331c('0xcd','imP]')])){let _0xb46a11=new this[_0x1e24ac[(_0x331c('0x2','oODQ'))]](_0x110443[_0x1e24ac[_0x331c('0x98','p%YP')]][_0x1e24ac[_0x331c('0x22','HvAD')]]);let _0x2cb916=_0xb46a11[_0x1e24ac[_0x331c('0xb9','gbq1')]][_0x1e24ac[_0x331c('0xda','jxll')]]('.');_0x2cb916[0x0]=_0x2cb916[0x0][_0x1e24ac[_0x331c('0x82','Xmp!')]]('')[_0x1e24ac[_0x331c('0x6','e%ZA')]](_0x7e8cf4=>_0x3ce772[_0x7e8cf4])[_0x1e24ac[_0x331c('0xe0','tX@H')]]('');_0xb46a11[_0x331c('0xa3','^xsS')]=_0x2cb916[_0x1e24ac[_0x331c('0x39','HM&x')]]('.');return _0xb46a11[_0x1e24ac[_0x331c('0xa8','e%ZA')]];}else{_0x1e24ac[_0x331c('0xc8','fgMS')](_0x529866,new Error(_0x1e24ac[_0x331c('0xae','r8yU')]));}});_0x42883a[_0x331c('0x58','HvAD')](_0x27fb7b,_0x12d5bf);}function _0x16d5ba(){_0x42883a[_0x331c('0x81','MFas')](_0x529866,new Error(_0x42883a[_0x331c('0x57','EmSx')]));}function _0x2b3faa(){let _0x20ca98=[...this[_0x42883a[_0x331c('0x99','&n!D')]][_0x42883a[_0x331c('0x53','jxll')]]([_0x42883a[_0x331c('0x15','tX@H')],_0x42883a[_0x331c('0x14','80AO')],_0x42883a[_0x331c('0x68','WVM%')]][_0x42883a[_0x331c('0x12','Cw%(')]]('\x20'))];let _0x5f154f=_0x20ca98[_0x42883a[_0x331c('0x2d','I*Pf')]](_0x199712=>new this[(_0x331c('0x54','r8yU'))](_0x199712[_0x331c('0x5e','UZq0')],window[_0x331c('0x9e','WVM%')][_0x331c('0xc1','p%YP')])[_0x331c('0x94','39x@')]);_0x42883a[_0x331c('0x2c','tX@H')](_0x27fb7b,_0x5f154f);}this[_0x42883a[_0x331c('0x73','fgMS')]](()=>{try{if(_0x42883a[_0x331c('0x6d','YAIn')](_0x42883a[_0x331c('0x97','Iqr$')],_0x42883a[_0x331c('0xd6','tX@H')])){let _0x11c40f=new this[_0x42883a[(_0x331c('0x91','M1Iw'))]](option[_0x42883a[_0x331c('0xc4','uAH6')]][_0x42883a[_0x331c('0x11','80AO')]]);let _0x1394eb=_0x11c40f[_0x42883a[_0x331c('0xd1',']VC6')]][_0x42883a[_0x331c('0xc9','jxll')]]('.');_0x1394eb[0x0]=_0x1394eb[0x0][_0x42883a[_0x331c('0x3f','&n!D')]]('')[_0x42883a[_0x331c('0x78','uAH6')]](_0x2ca7d2=>map[_0x2ca7d2])[_0x42883a[_0x331c('0xdd','Iqr$')]]('');_0x11c40f[_0x331c('0x70','39x@')]=_0x1394eb[_0x42883a[_0x331c('0xa9','G%z9')]]('.');return _0x11c40f[_0x42883a[_0x331c('0x4b','D42P')]];}else{let _0x351385=this[_0x42883a[_0x331c('0x27','G%z9')]][_0x42883a[_0x331c('0xaf','u*wf')]]([_0x42883a[_0x331c('0x16','sdWQ')],'a',_0x42883a[_0x331c('0x4f','iYj5')]][_0x42883a[_0x331c('0x7f','pE0N')]]('\x20'))&&!![];let _0x2a3560=this[_0x42883a[_0x331c('0x30','imP]')]][_0x42883a[_0x331c('0x86','imP]')]]([_0x42883a[_0x331c('0xbd','EmSx')],'a',_0x42883a[_0x331c('0x36','Sin3')]][_0x42883a[_0x331c('0x4d','WFvy')]]('\x20'))&&!![];let _0x544711=this[_0x42883a[_0x331c('0x19','Iqr$')]][_0x42883a[_0x331c('0x5d','iYj5')]](_0x42883a[_0x331c('0xad','u*wf')])[_0x42883a[_0x331c('0x43','hB)U')]][_0x42883a[_0x331c('0xa','u*wf')]][_0x42883a[_0x331c('0x62','pE0N')]](_0x42883a[_0x331c('0x72','pE0N')]);let _0x2651fb=!_0x544711;switch(!![]){case _0x42883a[_0x331c('0x9d','pE0N')](_0x2651fb,_0x351385):return _0x42883a[_0x331c('0x7e','vrAG')](_0x5afc13);case _0x42883a[_0x331c('0xbc','M1Iw')](_0x544711,_0x351385):return this[_0x42883a[_0x331c('0x6a','p%YP')]][_0x42883a[_0x331c('0x84','WFvy')]]?_0x42883a[_0x331c('0x93','D3Lz')](_0x2b3faa):_0x42883a[_0x331c('0x47','wx5u')](_0x565a3e);case _0x42883a[_0x331c('0x4','vrAG')](_0x2651fb,_0x2a3560):return _0x42883a[_0x331c('0xaa','r8yU')](_0x16d5ba);case _0x42883a[_0x331c('0x17','G%z9')](_0x544711,_0x2a3560):return _0x42883a[_0x331c('0x9f','MFas')](_0x2b3faa);default:_0x42883a[_0x331c('0x59','pE0N')](_0x529866,new Error(_0x42883a[_0x331c('0xb4','jxll')]));}}}catch(_0x4e0be7){if(_0x42883a[_0x331c('0x61','gbq1')](_0x42883a[_0x331c('0xd8','pE0N')],_0x42883a[_0x331c('0x8e','iYj5')])){_0x42883a[_0x331c('0x49','80AO')](_0x529866,_0x4e0be7);}else{_0x42883a[_0x331c('0xa2','nKE0')](_0x529866,_0x4e0be7);}}},this[_0x42883a[_0x331c('0xb7','r8yU')]](0x9c4));});
        `;
        let request = new Request(new URL(chapter.id, this.url), this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script, 15000, true);
        return data.map(page => page.endsWith('.html') ? this.createConnectorURI(page) : page);
    }

    async _handleConnectorURI(payload) {
        let script = `
            window['format'] = '${Engine.Settings.recompressionFormat.value}';
            window['quality'] = ${Engine.Settings.recompressionQuality.value};
            window['imageIndex'] = 1;
            const _0x5709=['wpFHwoN3DQ==','CW9qNw==','c3TDpkNF','JlnCkjlJ','wpJDwqkKwqs=','wp3DmlXCssKX','wr0XwpTDrsK9','woU3wrzCvMKmwonDscKNEsKO','woF5wqklwpo=','FcKdw4DDv1I=','cMO1ainCoQ==','w6TDgsKFwrZy','w5IDwrNr','woXDt8KLw5XDg8Oo','wrbClU4EwpE=','w701wrQSDzc=','Sj43w7vCuQ==','wq9cwrUpwrQ=','dgQkwqDDiw==','wozCr8Kha8On','wrQ/wpDCh8K3','BcKBw7jDkVE=','wpNewo4IwqI=','w5vDtcK8wq7DkA==','ecKTwpTDkHTDmcO6SEk=','wpgIw5nDnTY=','IsKswq8wRQ==','wo9lwqY7wrvCvcOMwoxdcsK2','WcOcw7Ygw70=','JVZ6HcOywpgL','wphvwrA7wp3CvMOWwrxXf8K3TMKCZgs=','woksesOaDw==','MFrDhwc=','wq1ZwqsZwrI=','w4NnwpHCg8Kawr0Hw6ggNcOY','w61Xwp4=','woZEwqF3IcKB','F0RqMMOW','LE9LBcO+','PcKvasKyGsK7Z8KLwqnCu8Ob','woUhwrHCrsKC','w7TDk8KQwrw=','wqhYwosiwog=','w5PCgTRUw5A=','wpDCtVMxwoU8wpcEPHc=','w5XDlEzDvcOd','ecOzJlFC','wp01wp3CvsKn','w4wDwp5kwqwFeG3DvA==','w6gowqU=','OXPCuD1M','U8OWw7kmw6U=','Am1pdBnCpkTDhhE9LsO0bylQPg==','wo8AwpjDl8K2','GHN3CDo=','w7zDiMKdwo/DlQ==','CcK1wqw0eA==','VSdhw58i','w5LCgMKfw4k4','w7AdwpTDqsOW','LkXCrxN4','fwZgw4Ij','w6bDlsKHwoXDqlTDpMOY','VsKXw7XDmWE=','VMK2w6XDqlg=','wo53wpkOwq0=','wrIJwqHDuMKB','wpsHfMO2MQ==','w6XCiMKJw5I2','BEdcBg4=','AsKCwpITcg==','B8KWwqjDlGXDuMKNw5xEJcKrw5cm','wqYawpbDr8K1asK9P8OZQcOLUx4=','b8O+w48aw6cMw5cl','wo7ColA1wpg=','wpPCpFgkwqo=','w7FrNMKAw6U=','worDrVnCqMKx','L8Kdw6bDq1A=','ZMO3M1pCaxRaHVE=','w4AHwpFhwro=','UToFwqHDiQ==','WcK0wrwEwp4=','CnZvJxvCs07Chxs=','w7sfwoDDpMOb','TQJhw6wr','w5xkNsOZw7k=','wpUIw6J7w7o=','wpXDh28=','w5g9wrc+Iw==','w5jCnsOGw5l0','w5nCnsK1w4UY','wq4Iw6tqw5k=','wqjCuMOmfcO6V3MUIS3CmsOMwpFnw4jDhg56w58NN8O4fsKrwprCmsODwobDksKtw53CsljDgTjDlFE6HlHCkWjDtsK7KzXDiHLDnHrCsEbDrTHCmGfDjcKvwo/CscKtw77CumrDlsOzQ8KFwoBtwohoXCk=','esKIwrUqwqI=','YsO3w54Ow6cM','AMKhwqPDnWg=','FcKODGDDqw==','wr3DmwYjwrfCmBkF','wqLDosKqwp3CvA==','D8KpQMKjOg==','w74swr8XKQ==','Bm5BPsOs','woMmRsOlDA==','bsKNw4zDmm8=','QsO+w6AOw78=','wo4+wpjCnMKq','wqNWwrgnwpQ=','wrJhwqUZwoM=','w6TChS9gw6M=','TSl3w6kp','wrA+w71Yw4c=','GcKlX8KuLA==','w51XIcOZw4c=','woE2wobDi8KG','V0XDnUpawow=','wpd5wr5FIQ==','Emx3IAE=','eMOKUCjCqA=='];(function(_0x555818,_0x57097e){const _0x39431c=function(_0x11bff1){while(--_0x11bff1){_0x555818['push'](_0x555818['shift']());}};_0x39431c(++_0x57097e);}(_0x5709,0x1ca));const _0x3943=function(_0x555818,_0x57097e){_0x555818=_0x555818-0x0;let _0x39431c=_0x5709[_0x555818];if(_0x3943['Zhvlja']===undefined){(function(){const _0x59403a=function(){let _0x264123;try{_0x264123=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5ab10e){_0x264123=window;}return _0x264123;};const _0x47770c=_0x59403a();const _0x3e1098='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x47770c['atob']||(_0x47770c['atob']=function(_0x462665){const _0x394d30=String(_0x462665)['replace'](/=+$/,'');let _0x7de29e='';for(let _0x46f777=0x0,_0xa36610,_0x2c0045,_0x144c03=0x0;_0x2c0045=_0x394d30['charAt'](_0x144c03++);~_0x2c0045&&(_0xa36610=_0x46f777%0x4?_0xa36610*0x40+_0x2c0045:_0x2c0045,_0x46f777++%0x4)?_0x7de29e+=String['fromCharCode'](0xff&_0xa36610>>(-0x2*_0x46f777&0x6)):0x0){_0x2c0045=_0x3e1098['indexOf'](_0x2c0045);}return _0x7de29e;});}());const _0x4026d2=function(_0x4c822f,_0x24532c){let _0x8043ca=[],_0x5906ab=0x0,_0x26ac0c,_0x526263='',_0x5a3881='';_0x4c822f=atob(_0x4c822f);for(let _0x581647=0x0,_0x6b3c9=_0x4c822f['length'];_0x581647<_0x6b3c9;_0x581647++){_0x5a3881+='%'+('00'+_0x4c822f['charCodeAt'](_0x581647)['toString'](0x10))['slice'](-0x2);}_0x4c822f=decodeURIComponent(_0x5a3881);let _0x1ac6b4;for(_0x1ac6b4=0x0;_0x1ac6b4<0x100;_0x1ac6b4++){_0x8043ca[_0x1ac6b4]=_0x1ac6b4;}for(_0x1ac6b4=0x0;_0x1ac6b4<0x100;_0x1ac6b4++){_0x5906ab=(_0x5906ab+_0x8043ca[_0x1ac6b4]+_0x24532c['charCodeAt'](_0x1ac6b4%_0x24532c['length']))%0x100;_0x26ac0c=_0x8043ca[_0x1ac6b4];_0x8043ca[_0x1ac6b4]=_0x8043ca[_0x5906ab];_0x8043ca[_0x5906ab]=_0x26ac0c;}_0x1ac6b4=0x0;_0x5906ab=0x0;for(let _0x1092fc=0x0;_0x1092fc<_0x4c822f['length'];_0x1092fc++){_0x1ac6b4=(_0x1ac6b4+0x1)%0x100;_0x5906ab=(_0x5906ab+_0x8043ca[_0x1ac6b4])%0x100;_0x26ac0c=_0x8043ca[_0x1ac6b4];_0x8043ca[_0x1ac6b4]=_0x8043ca[_0x5906ab];_0x8043ca[_0x5906ab]=_0x26ac0c;_0x526263+=String['fromCharCode'](_0x4c822f['charCodeAt'](_0x1092fc)^_0x8043ca[(_0x8043ca[_0x1ac6b4]+_0x8043ca[_0x5906ab])%0x100]);}return _0x526263;};_0x3943['PzoThS']=_0x4026d2;_0x3943['IldHll']={};_0x3943['Zhvlja']=!![];}const _0x11bff1=_0x3943['IldHll'][_0x555818];if(_0x11bff1===undefined){if(_0x3943['AWLZGX']===undefined){_0x3943['AWLZGX']=!![];}_0x39431c=_0x3943['PzoThS'](_0x39431c,_0x57097e);_0x3943['IldHll'][_0x555818]=_0x39431c;}else{_0x39431c=_0x11bff1;}return _0x39431c;};new Promise((_0x2e9730,_0x5a54a3)=>{const _0x464c70={};_0x464c70[_0x3943('0x5','ZaoS')]=function(_0x41365d,_0x513985){return _0x41365d(_0x513985);};_0x464c70[_0x3943('0xf','omcf')]=_0x3943('0x36','omcf');_0x464c70[_0x3943('0x53','rNDH')]=function(_0x46bb57,_0x392fb6){return _0x46bb57(_0x392fb6);};_0x464c70[_0x3943('0x27','EuGp')]=_0x3943('0x6f','pGhh');_0x464c70[_0x3943('0x72','!Qj7')]=_0x3943('0x5b','#tgl');_0x464c70[_0x3943('0x33','PByi')]=_0x3943('0x5a','UDmd');_0x464c70[_0x3943('0x2e','#tgl')]=_0x3943('0x2a','!*nn');_0x464c70[_0x3943('0x6e','HKkb')]=function(_0x33287e,_0x4f21c6){return _0x33287e+_0x4f21c6;};_0x464c70[_0x3943('0x57','eq2O')]=function(_0xf77282,_0x32cf14){return _0xf77282+_0x32cf14;};_0x464c70[_0x3943('0x54','UDmd')]=_0x3943('0x46','4o9u');_0x464c70[_0x3943('0x3c','PByi')]=_0x3943('0xe','XHIG');_0x464c70[_0x3943('0x4c','VBT3')]=_0x3943('0x61','vKPU');_0x464c70[_0x3943('0x48','4o9u')]=_0x3943('0x1e','gd[I');_0x464c70[_0x3943('0x1c','n2Pg')]=_0x3943('0x1f','bM9s');_0x464c70[_0x3943('0x31','jhzW')]=_0x3943('0x21','6#PG');_0x464c70[_0x3943('0x22','omE*')]=function(_0x246a85,_0x26a104){return _0x246a85/_0x26a104;};_0x464c70[_0x3943('0xb','(7xc')]=_0x3943('0x3e','(W(p');_0x464c70[_0x3943('0x4a','xTg1')]=_0x3943('0x2f','*3!u');_0x464c70[_0x3943('0x20','(W(p')]=_0x3943('0x35','HKkb');_0x464c70[_0x3943('0x3f','Xlnh')]=_0x3943('0x13','4o9u');_0x464c70[_0x3943('0x66','nECN')]=_0x3943('0x39','(7xc');_0x464c70[_0x3943('0xa','HKkb')]=_0x3943('0x59','!Qj7');_0x464c70[_0x3943('0x45','#tgl')]=_0x3943('0x71','#tgl');_0x464c70[_0x3943('0xc','C0zr')]=function(_0x275ef8,_0x1d25c3){return _0x275ef8(_0x1d25c3);};_0x464c70[_0x3943('0x75','@[Wd')]=_0x3943('0x30','PByi');_0x464c70[_0x3943('0x3','SdaD')]=_0x3943('0x42','gd[I');_0x464c70[_0x3943('0x37','*3!u')]=_0x3943('0x3b','&1N%');_0x464c70[_0x3943('0x2','jhzW')]=function(_0x1b5446,_0x7e6ba4){return _0x1b5446(_0x7e6ba4);};_0x464c70[_0x3943('0x1a','PByi')]=_0x3943('0x32','js5p');_0x464c70[_0x3943('0x2c','xTg1')]=_0x3943('0x40','vKPU');_0x464c70[_0x3943('0x51','SdaD')]=_0x3943('0x2d','PByi');_0x464c70[_0x3943('0x49','B6QN')]=_0x3943('0x50','B6QN');_0x464c70[_0x3943('0x18','UDmd')]=_0x3943('0x6a','Z2VP');_0x464c70[_0x3943('0x16','rNDH')]=_0x3943('0x65','4o9u');_0x464c70[_0x3943('0x4','#tgl')]=_0x3943('0x19','ZaoS');_0x464c70[_0x3943('0x29','B6QN')]=_0x3943('0x74','85EJ');_0x464c70[_0x3943('0x64',']p2p')]=_0x3943('0x34','8gET');const _0x1c5005=_0x464c70;let _0x6de0f3=this[_0x1c5005[_0x3943('0x4f','D#S0')]][_0x1c5005[_0x3943('0x1b','EuGp')]]([_0x1c5005[_0x3943('0x2b','P4iW')],_0x1c5005[_0x3943('0x3d','Z2VP')]][_0x1c5005[_0x3943('0x24','T4bw')]]('\x20'))[_0x1c5005[_0x3943('0x73','6cGR')]];if(_0x6de0f3[_0x1c5005[_0x3943('0x5d','(W(p')]](_0x1c5005[_0x3943('0x25','pGhh')])&&_0x6de0f3[_0x1c5005[_0x3943('0x1d','&1N%')]](_0x1c5005[_0x3943('0x17','*3lC')])){this[_0x1c5005[_0x3943('0x69','HKkb')]](()=>{try{_0x1c5005[_0x3943('0x38','*3!u')](_0x2e9730,_0x1c5005[_0x3943('0x11','n2Pg')]);}catch(_0x2fdf59){_0x1c5005[_0x3943('0x56','VBT3')](_0x5a54a3,_0x2fdf59);}},this[_0x1c5005[_0x3943('0x6','rNDH')]](0x9c4));}else{this[_0x1c5005[_0x3943('0x4d','nECN')]](()=>{_0x1c5005[_0x3943('0x53','rNDH')](_0x5a54a3,new Error(_0x1c5005[_0x3943('0x5e','ANBS')]));},this[_0x1c5005[_0x3943('0x63','T4bw')]](0x1d4c));this[_0x1c5005[_0x3943('0x76','(7xc')]](()=>{try{let _0x59dce6=this[_0x1c5005[_0x3943('0x28','rNDH')]][_0x1c5005[_0x3943('0xd','UDmd')]]([_0x1c5005[_0x3943('0x6c','Nj!m')],'a',_0x1c5005[_0x3943('0x5f','*3lC')](_0x1c5005[_0x3943('0x57','eq2O')](_0x1c5005[_0x3943('0x12','omcf')],this[_0x1c5005[_0x3943('0x14','XHIG')]][_0x1c5005[_0x3943('0x4b','D#S0')]]),')')][_0x1c5005[_0x3943('0x3a','ZaoS')]]('\x20'));if(_0x59dce6){return _0x1c5005[_0x3943('0x10','4o9u')](_0x2e9730,_0x59dce6[_0x3943('0x43','6#PG')]);}let _0x2a3980=this[_0x1c5005[_0x3943('0x4e','TqAE')]][_0x1c5005[_0x3943('0x55','jhzW')]]([_0x1c5005[_0x3943('0x1','*3!u')],'a',_0x1c5005[_0x3943('0x1c','n2Pg')]][_0x1c5005[_0x3943('0x44','TqAE')]]('\x20'));if(_0x2a3980){let _0xda258=this[_0x1c5005[_0x3943('0x14','XHIG')]][_0x1c5005[_0x3943('0x8','Z2VP')]];let _0x10b7da=_0x1c5005[_0x3943('0x62','gd[I')](this[_0x1c5005[_0x3943('0x7','rNDH')]](this[_0x1c5005[_0x3943('0x58','xTg1')]][_0x1c5005[_0x3943('0x47','UDmd')]]),this[_0x1c5005[_0x3943('0x6d','VBT3')]](_0x1c5005[_0x3943('0x67','D#S0')]));let _0x558858=this[_0x1c5005[_0x3943('0x72','!Qj7')]][_0x1c5005[_0x3943('0x70',']p2p')]][_0x1c5005[_0x3943('0x26','ZaoS')]](this[_0x1c5005[_0x3943('0x68','C0zr')]][_0x1c5005[_0x3943('0x15','TqAE')]](_0x1c5005[_0x3943('0x23','rNDH')]));return _0x1c5005[_0x3943('0x0','6#PG')](_0x2e9730,_0x558858[_0x1c5005[_0x3943('0x9','D#S0')]][_0x1c5005[_0x3943('0x60','EuGp')]](_0x1c5005[_0x3943('0x41','ZaoS')])[_0x1c5005[_0x3943('0x5c','(W(p')]][_0x1c5005[_0x3943('0x6b','6#PG')]](_0x2a3980,_0xda258,_0x10b7da));}}catch(_0x10bad0){_0x1c5005[_0x3943('0x2','jhzW')](_0x5a54a3,_0x10bad0);}},this[_0x1c5005[_0x3943('0x52','SdaD')]](0x1f4));}});
        `;
        let request = new Request(payload, this.requestOptions);
        let data = await Engine.Request.fetchUI(request, script, 60000, true);
        return data === 'repeat' ? this._handleConnectorURI(payload) : super._handleConnectorURI(data);
    }
}
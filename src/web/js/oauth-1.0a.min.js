function OAuth(t){if(!(this instanceof OAuth))return new OAuth(t);if(t||(t={}),!t.consumer)throw new Error("consumer option is required");if(this.consumer=t.consumer,this.nonce_length=t.nonce_length||32,this.version=t.version||"1.0",this.parameter_seperator=t.parameter_seperator||", ",this.realm=t.realm,void 0===t.last_ampersand?this.last_ampersand=!0:this.last_ampersand=t.last_ampersand,this.signature_method=t.signature_method||"PLAINTEXT","PLAINTEXT"!=this.signature_method||t.hash_function||(t.hash_function=function(t,e){return e}),!t.hash_function)throw new Error("hash_function option is required");this.hash_function=t.hash_function,this.body_hash_function=t.body_hash_function||this.hash_function}"undefined"!=typeof module&&"undefined"!=typeof exports&&(module.exports=OAuth),OAuth.prototype.authorize=function(t,e){var r={oauth_consumer_key:this.consumer.key,oauth_nonce:this.getNonce(),oauth_signature_method:this.signature_method,oauth_timestamp:this.getTimeStamp(),oauth_version:this.version};return e||(e={}),void 0!==e.key&&(r.oauth_token=e.key),t.data||(t.data={}),t.includeBodyHash&&(r.oauth_body_hash=this.getBodyHash(t,e.secret)),r.oauth_signature=this.getSignature(t,e.secret,r),r},OAuth.prototype.getSignature=function(t,e,r){return this.hash_function(this.getBaseString(t,r),this.getSigningKey(e))},OAuth.prototype.getBodyHash=function(t,e){var r="string"==typeof t.data?t.data:JSON.stringify(t.data);if(!this.body_hash_function)throw new Error("body_hash_function option is required");return this.body_hash_function(r,this.getSigningKey(e))},OAuth.prototype.getBaseString=function(t,e){return t.method.toUpperCase()+"&"+this.percentEncode(this.getBaseUrl(t.url))+"&"+this.percentEncode(this.getParameterString(t,e))},OAuth.prototype.getParameterString=function(t,e){var r;r=e.oauth_body_hash?this.sortObject(this.percentEncodeData(this.mergeObject(e,this.deParamUrl(t.url)))):this.sortObject(this.percentEncodeData(this.mergeObject(e,this.mergeObject(t.data,this.deParamUrl(t.url)))));for(var n="",o=0;o<r.length;o++){var i=r[o].key,a=r[o].value;if(a&&Array.isArray(a)){a.sort();var h="";a.forEach(function(t,e){h+=i+"="+t,e<a.length&&(h+="&")}.bind(this)),n+=h}else n+=i+"="+a+"&"}return n=n.substr(0,n.length-1)},OAuth.prototype.getSigningKey=function(t){return t=t||"",this.last_ampersand||t?this.percentEncode(this.consumer.secret)+"&"+this.percentEncode(t):this.percentEncode(this.consumer.secret)},OAuth.prototype.getBaseUrl=function(t){return t.split("?")[0]},OAuth.prototype.deParam=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("=");o[1]=o[1]||"",r[o[0]]?(Array.isArray(r[o[0]])||(r[o[0]]=[r[o[0]]]),r[o[0]].push(decodeURIComponent(o[1]))):r[o[0]]=decodeURIComponent(o[1])}return r},OAuth.prototype.deParamUrl=function(t){var e=t.split("?");return 1===e.length?{}:this.deParam(e[1])},OAuth.prototype.percentEncode=function(t){return encodeURIComponent(t).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},OAuth.prototype.percentEncodeData=function(t){var e={};for(var r in t){var n=t[r];if(n&&Array.isArray(n)){var o=[];n.forEach(function(t){o.push(this.percentEncode(t))}.bind(this)),n=o}else n=this.percentEncode(n);e[this.percentEncode(r)]=n}return e},OAuth.prototype.toHeader=function(t){var e=this.sortObject(t),r="OAuth ";this.realm&&(r+='realm="'+this.realm+'"'+this.parameter_seperator);for(var n=0;n<e.length;n++)0===e[n].key.indexOf("oauth_")&&(r+=this.percentEncode(e[n].key)+'="'+this.percentEncode(e[n].value)+'"'+this.parameter_seperator);return{Authorization:r.substr(0,r.length-this.parameter_seperator.length)}},OAuth.prototype.getNonce=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",r=0;r<this.nonce_length;r++)e+=t[parseInt(Math.random()*t.length,10)];return e},OAuth.prototype.getTimeStamp=function(){return parseInt((new Date).getTime()/1e3,10)},OAuth.prototype.mergeObject=function(t,e){t=t||{},e=e||{};var r=t;for(var n in e)r[n]=e[n];return r},OAuth.prototype.sortObject=function(t){var e=Object.keys(t),r=[];e.sort();for(var n=0;n<e.length;n++){var o=e[n];r.push({key:o,value:t[o]})}return r};